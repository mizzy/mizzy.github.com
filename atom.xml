<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Gosuke Miyashita]]></title>
  <link href="http://mizzy.org/atom.xml" rel="self"/>
  <link href="http://mizzy.org/"/>
  <updated>2017-10-11T12:29:40+09:00</updated>
  <id>http://mizzy.org/</id>
  <author>
    <name><![CDATA[Gosuke Miyashita]]></name>
    
  </author>
  <generator uri="https://github.com/mizzy/stellar/">Stellar</generator>


  <entry>
    <title type="html"><![CDATA[Rust で D-Bus 経由で systemd から情報を得る]]></title>
    <link href="http://mizzy.org/blog/2017/10/11/1/" />
    <updated>2017-10-11T12:29:40+09:00</updated>
    <id>http://mizzy.org/blog/2017/10/11/1/</id>
    <content type="html"><![CDATA[
<p>色々試行錯誤したのでメモ。</p>

<hr>

<h2>結論</h2>

<p><a href="https://crates.io/crates/dbus">dbus crate</a> を使う。</p>

<hr>

<h2>経緯</h2>

<p>開発中の <a href="http://atl.recruit-tech.co.jp/blog/4339/">libspecinfra</a> で、systemd 配下の service の状態を取得できるようにするための provider を書こうと思い、色々調べたりコード書いて試したりした。</p>

<hr>

<h2>使えそうな crates を探す</h2>

<p>まずは目的に合う crates がないか <a href="https://crates.io/">crates.io</a> で検索。ざっと以下のようなものが見つかる。</p>

<ul>
<li><a href="https://crates.io/crates/systemd">systemd</a></li>
<li><a href="https://crates.io/crates/systemd-dbus">systemd-dbus</a></li>
<li><a href="https://crates.io/crates/dbus">dbus</a></li>
<li><a href="https://crates.io/crates/dbus-bytestream">dbus-bytestream</a></li>
</ul>

<p>systemd crate は <a href="https://github.com/systemd/systemd/tree/master/src/libsystemd">libsystemd</a> の Rust インターフェースで、<a href="https://www.freedesktop.org/software/systemd/man/sd-daemon.html">sd-daemon</a>、<a href="https://www.freedesktop.org/software/systemd/man/sd-id128.html">sd-id128</a>、<a href="https://www.freedesktop.org/software/systemd/man/sd-journal.html">sd-journal</a>、<a href="https://www.freedesktop.org/software/systemd/man/sd-login.html">sd-login </a> に対応している。が <a href="https://www.freedesktop.org/software/systemd/man/sd-bus.html">sd-bus</a> は <a href="https://github.com/jmesmon/rust-systemd/blob/aead34dcf64e90014da0fadfe54ea439a19ce8c4/src/lib.rs#L68">まだ実装が不完全</a> なようなので、目的には合わなさそう、と判断。</p>

<p>systemd-dbus crate は2年半以上更新がなく、rust 1.19.0 でコンパイルが通らなかったので断念。</p>

<p>他に systemd を直接扱える、目的に適いそうな crate が見当たらなかったので、D-Bus が扱える crate ってことで、dbus crate と dbus-bytestream create を試してみることにした。</p>

<hr>

<h2>dbus-send で D-Bus を理解する</h2>

<p>dbus crate にしても dbus-bytestream crate にしても、ざっとドキュメントやコードを読んだ感じ、D-Bus でどういった形でメッセージのやりとりがなされているのかを理解しないと、使うのは無理だなこれは、と思ったので、まずは <a href="https://dbus.freedesktop.org/doc/dbus-send.1.html">dbus-send</a> コマンドで必要な情報が得られるかどうかトライしてみた。</p>

<p>libspecinfra でやりたいことのひとつは、サービスが動いているかどうかを調べること。dbus-send では以下のような形で実行すれば、この情報が得られることがわかった。</p>

<p>まずはユニット名(ssh.service)からオブジェクトパス(/org/freedesktop/systemd1/unit/ssh_2eservice)を取得。</p>

<pre><code>$ dbus-send --system \
   --dest=org.freedesktop.systemd1 \
   --type=method_call \
   --print-reply \
   /org/freedesktop/systemd1 \
   org.freedesktop.systemd1.Manager.GetUnit \
   string:ssh.service

method return time=1507693363.257785 sender=:1.10 -&gt; destination=:1.220 serial=3078 reply_serial=2
   object path &quot;/org/freedesktop/systemd1/unit/ssh_2eservice&quot;
</code></pre>

<p><code>--dest=org.freedesktop.systemd1</code> で接続先のバス名を指定。<code>/org/freedesktop/systemd1</code> が操作対象のオブジェクトパス、<code>org.freedesktop.systemd1.Manager</code> がインターフェースで、それに続く <code>GetUnit</code> が呼び出すメソッド、<code>string:ssh.service</code> がメソッドに渡す引数、という形式になっている。</p>

<p>このオブジェクトパスの ActiveState プロパティを取得。</p>

<pre><code>$ dbus-send --system \
   --dest=org.freedesktop.systemd1 \
   --type=method_call \
   --print-reply \
   /org/freedesktop/systemd1/unit/ssh_2eservice \
   org.freedesktop.DBus.Properties.Get \
   string:org.freedesktop.systemd1.Unit \
   string:ActiveState

method return time=1507693392.955268 sender=:1.10 -&gt; destination=:1.221 serial=3079 reply_serial=2
   variant       string &quot;active&quot;
</code></pre>

<p>これでサービスの状態を得ることができた。</p>

<p>どのようなメソッドやプロパティがあるかは <a href="https://www.freedesktop.org/wiki/Software/systemd/dbus/">The D-Bus API of systemd/PID 1</a> に載っている。</p>

<hr>

<h2>Rust で dbus-send で得たのと同じ情報を得る</h2>

<p>dbus crate を使って以下のようなコードを書けば良い。</p>

<div><script src='https://gist.github.com/0210a1b8c56c1bf1411b1b8e310e90d8.js?file='></script>
<noscript><pre><code></code></pre></noscript></div>

<p>試したコードは Cargo.toml 等も含めて <a href="https://github.com/mizzy/rust-systemd-playground">GitHub</a> に置いてある。</p>

<p>dbus crate は <a href="https://github.com/diwic/dbus-rs/tree/master/dbus/examples">サンプルコード</a> もあるし、<a href="https://github.com/diwic/dbus-rs/blob/master/dbus/examples/argument_guide.md">ドキュメント</a> もあるので、ドキュメントがほとんどない dbus-bytestream crate と比べると、比較的扱いやすいように思える（といっても、ドキュメント読めばすべてわかる、というわけではなく、コードも読んで色々試行錯誤したけど）。</p>

<p>dbus-bytestream も同時に試したけど、取得した ActiveState の情報をデコードする方法がよくわからないまま、dbus crate の方が動いたので、途中で断念した。なので、GitHub 上にある dbus-bytestream を使ったコードはエラーで動かない。</p>

]]></content>
  </entry>

  <entry>
    <title type="html"><![CDATA[OBD-IIアダプタ経由で車両情報を Mac から取得してみる]]></title>
    <link href="http://mizzy.org/blog/2017/09/06/1/" />
    <updated>2017-09-06T18:00:00+09:00</updated>
    <id>http://mizzy.org/blog/2017/09/06/1/</id>
    <content type="html"><![CDATA[
<p>最近車に乗ることが多く、ほぼ毎日乗っているせいか、コネクテッドカー関連の技術に興味が沸いてきた。ので、調べたことや試したことなんかをメモしていく。</p>

<p>まずは車両情報をパソコンから取得することにトライ。調べてみると、車両情報をパソコンやスマホから取得するためには、車に搭載された <a href="https://ja.wikipedia.org/wiki/%E8%87%AA%E5%8B%95%E8%BB%8A%E3%81%AE%E8%87%AA%E5%B7%B1%E8%A8%BA%E6%96%AD%E6%A9%9F%E8%83%BD#OBD2">OBD-II</a> ポートに、<a href="https://www.elmelectronics.com/">ELM Electronics 社</a> 製の ELM327 というチップを積んだアダプタを挿し、Bluetooth や Wi-Fi を経由して取得する、というやり方が一般的なようだ。</p>

<p>というわけで、<a href="https://www.amazon.co.jp/gp/product/B00J7CC4T2">Bluetooth 版</a> （写真左）と <a href="https://www.amazon.co.jp/gp/product/B01IHV5VFM">Wi-Fi 版</a>（写真右）を買ってみた。 </p>

<p><img src="/images/2017/09/elm327.jpg" title="ELM327" ></p>

<p>まずは Bluetooth 版。macOS Sierra の場合、ペアリングすると <code>/dev/tty.OBDII-Port</code> というデバイスファイルが見えるようになるので、<code>screen</code> コマンドで接続して対話する。</p>

<pre><code>$ screen /dev/tty.OBDII-Port
&gt;ONNECTED
</code></pre>

<p>正しく改行され表示されるよう、ラインフィードをオンにする。</p>

<pre><code>&gt;atl1
OK
</code></pre>

<p>識別コードを表示させると、ELM327のバージョンが表示される。</p>

<pre><code>&gt;ati
ELM327 v1.5
</code></pre>

<p>プロトコルを表示させてみる。<a href="https://www.elmelectronics.com/products/ics/obd/">ELM327 は様々なプロトコルに対応している</a> が、この車が対応しているプロトコルは ISO 15765-4 (CAN 11/500) で、自動で認識しているようだ。</p>

<pre><code>&gt;atdp
AUTO, ISO 15765-4 (CAN 11/500)
</code></pre>

<p>他に使える AT コマンドについては、 <a href="https://www.sparkfun.com/datasheets/Widgets/ELM327_AT_Commands.pdf">ELM327 がサポートしている AT コマンド一覧（PDF）</a> を見ると良い。</p>

<p>次に車両情報を取得してみる。OBD-IIポートから情報を取得するには、PID(Parameter ID) と呼ばれるコードを入力する。<a href="https://en.wikipedia.org/wiki/OBD-II_PIDs">PID の一覧はここに載っている</a>。</p>

<p>ここにある PID をすべての車がサポートしているわけではないし、メーカーや車独自の PID もあるらしい。</p>

<p><a href="https://en.wikipedia.org/wiki/OBD-II_PIDs#Standard_PIDs">標準で定められた PID の一覧はここに載っている</a>。</p>

<p>これを見ると、PID には <a href="https://en.wikipedia.org/wiki/OBD-II_PIDs#Modes">Mode</a> という大まかなカテゴリがあり、Mode につづいて必要な情報の PID を入力するようだ。例えば、対応している PID の一覧を取得するためのコードは、Mode 01、PID 00 なので、0100 と入力する。</p>

<pre><code>&gt;0100
41 00 98 18 00 01
41 00 BE 3E B8 13
</code></pre>

<p><a href="https://en.wikipedia.org/wiki/OBD-II_PIDs#Query">Wikipedia ページの Query の項目</a> には、先頭に「Number of additional data bytes」というのがあるけど、これはなくてもいい？よくわからない。</p>

<p>レスポンスのフォーマットも <a href="https://en.wikipedia.org/wiki/OBD-II_PIDs#Response">Wikipedia に載っている</a>。こちらも先頭に「Number of additional data bytes」というのがあるけど、実際に試したレスポンスには含まれてなさそう。</p>

<p>レスポンスの最初の <code>41</code> は 40 に Mode を足した値で、その次の <code>00</code> は Mode を含まない PID をそのまま返しているので、実際に読むべき値はその次の <code>98 18 00 01</code> と <code>BE 3E B8 13</code> になる。レスポンスが2行になっているのは、おそらく2つの ECU(Engine Control Unit) から値を取得しているからだろう。どうやら片方がエンジン系ECU、片方がトランスミッション系ECUらしいのだが、この辺りもよくわかってない。</p>

<p>レスポンスは、PID 01〜20 の中で対応しているものをビットエンコードしたもので、読み方は <a href="https://en.wikipedia.org/wiki/OBD-II_PIDs#Mode_1_PID_00">Wikipedia を参照</a>。</p>

<p>Engine coolant temperature の取得はコード <code>0105</code> で行う。<code>41 05</code> を除いた <code>58</code> が見るべき値だが、これは 16進数なので10進数では 88 になるが、<a href="https://en.wikipedia.org/wiki/OBD-II_PIDs#Mode_01">Wikipedia でこの PID の Formula</a> を見ると「A - 40」と書かれているので、88 - 40 = 44℃ が実際に知りたかった値となる。</p>

<pre><code>&gt;0105
41 05 58
41 05 58
</code></pre>

<p>Wi-Fi版のものは、車に挿してイグニッションオンにすると、WiFi_OBDII という SSID が表示されるので、接続してやる。</p>

<p><img src="/images/2017/09/wifi-obd2.jpg" title="WiFi_OBDII" ></p>

<p>すると、192.168.0.10:35000 に繋いで対話できるので、telnet や nc コマンド等で接続して対話する。</p>

<p>ATコマンドは Bluetooth 版と同様。</p>

<pre><code>$ telnet 192.168.0.10 35000
Trying 192.168.0.10...
Connected to 192.168.0.10.
Escape character is &#39;^]&#39;.
atl1
OK

&gt;ati
ELM327 v1.5

&gt;atdp
AUTO,ISO 15765-4 (CAN 11/500)
</code></pre>

<p>車両情報を取得してみると、レスポンスが Bluetooth 版と異なる。</p>

<pre><code>&gt;0100
7E8064100BE3EB813
7E906410098180001

&gt;0105
7E903410585
7E803410585

&gt;0120
7E8064120A007A011
7E906412000000001
</code></pre>

<p><code>7E806</code> や <code>7E903</code> といった部分が、Bluetooth 版のレスポンスにはないが、これはどうやら <a href="https://ja.wikipedia.org/wiki/Controller_Area_Network">CAN</a> というプロトコルのデータフレームに含まれているもののようだ。 </p>

<p><a href="http://monoist.atmarkit.co.jp/mn/articles/0807/09/news140.html">CAN通信におけるデータ送信の仕組みとは？ (1/3) - MONOist（モノイスト）</a> を見ると、<code>7E8</code> や <code>7E9</code> が識別のための ID、続く <code>06</code> や <code>03</code> はコントロールフィールド中のデータレングスコードで、その後に続くデータフィールドの長さを表しているようだ。</p>

<p>内部的には ECU 同士や ECU と OBD-IIアダプタ間では CAN で通信していて、Bluetooth 版アダプタは、CAN のデータフレームのうち、データフィールドしか出力しないけど、Wi-Fi版アダプタは、ID やコントロールフィールドも出力している、ということなのだろう。</p>

]]></content>
  </entry>

  <entry>
    <title type="html"><![CDATA[フリーランスになって3年が経った]]></title>
    <link href="http://mizzy.org/blog/2017/04/01/1/" />
    <updated>2017-04-01T12:07:02+09:00</updated>
    <id>http://mizzy.org/blog/2017/04/01/1/</id>
    <content type="html"><![CDATA[
<blockquote class="twitter-tweet" data-lang="en"><p lang="ja" dir="ltr">株式会社はてなに入社して二軒目の家を建てました。 <a href="https://t.co/a4UFOYRW8M">https://t.co/a4UFOYRW8M</a></p>&mdash; Gosuke Miyashita (@gosukenator) <a href="https://twitter.com/gosukenator/status/847829344651051008">March 31, 2017</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>このはてな入社エイプリルフールネタもそろそろ飽きられてそうなので、少しだけ変化させた。今年は土曜日というタイミングもあって、本当だと思う人は皆無だろうし。</p>

<p>はてなに入社すると家が建つ、というやつ、どういうコンテキストだったか忘れてしまった。</p>

<p><a href="http://mizzy.org/blog/2016/04/01/1/">フリーランスになって2年が経った</a> で触れたように、昨年2月に法人登記したので自分をフリーランスと呼んで良いのかどうかよくわからないけど、働き方はまったく変わってないので、フリーランスで
いいのだろうと思っている。</p>

<hr>

<h2>仕事について</h2>

<p>昨年は <a href="http://atl.recruit-tech.co.jp/">リクルートテクノロジーズATL</a> での仕事がメインで、あとは技術顧問的なものや golang でのミドルウェア開発なんかをやっていた。</p>

<p>ATL での仕事は OSS 開発支援とプレゼンス向上のお手伝いという2つのミッションがある。OSS 開発支援、元々は <a href="https://github.com/walter-cd/walter">Walter</a> を最初につくった <a href="https://github.com/ainoya">ainoya</a> さんから <a href="https://github.com/takahi-i">takahi-i</a> さんが開発を引き継いだ際に、<a href="https://github.com/lyokato">lyokato</a> さんからの紹介で手伝ってもらえないか、という話があって請けた仕事だった。その takahi-i さんも、紹介してくれた lyokato さんも ATL を離れてしまったし、Walter と似た立ち位置のツールは他に優れたものが色々あるので、開発のモチベーションが失われてしまった。なので、Walter の方はコードをすっきりさせるためにリライトした v2.0 をリリースした後は、細々とメンテしていくモードに入っている。Walter は <a href="http://mizzy.org/blog/2015/06/16/1/">Serverspec のインテグレーションテスト</a> で使っているので、バグ修正とか、細かな調整とかは今後もしていくけど、大きな機能追加などはおそらくやらないだろう。</p>

<p>takahi-i さんの Walter 開発のお手伝い、ということで請けた仕事なので、takahi-i さんが ATL を離れるにともない、契約終了かと思ったらそうはならず、契約は続いている。なので、Walter の代わりに別の OSS プロジェクトをはじめさせてもらった。これについては別途エントリを書いたり、近々 <a href="https://cloudinfra.audio/">Noboly’s CloudInfra Podcast</a> で話したりする予定。</p>

<p>プレゼンス向上の仕事としては、<a href="https://atnd.org/events/78581">Recruit Technologies Open Lab #03 テーマ：Infrastructure as Code</a> というイベントをやった。テーマが良いためか、ゲストスピーカーのおかげか、キャンセル含めると400名以上の応募があった。会場キャパシティの都合で参加できなかった方、本当にすみません。</p>

<p>また、<a href="https://www.oreilly.co.jp/books/9784873117966/">オライリーの Infrastructure as Code 本</a> の監訳をやった。これは ATL のプレゼンス向上とは関係なさそうだけど、監訳者紹介のところに ATL の名前を出すことで、少しはプレゼンス向上に貢献できるだろう、ということで、直接的にはオライリーさんから請けた仕事ではあるけど、間接的には ATL の仕事でもある、と解釈してる。</p>

<p>ATL の仕事、2週間に1回マネージャーとのミーティングのためにオフィスに行くが、それ以外は家でやっている。なので、朝夕は子供の送り迎えをしたり（割と大変だった。下記ツイート参照）、昼は妻と車で出かけて食事をした後、スーパーで家族7人分の食材を買って帰ったり、平日の空いてる時間帯にレジャー施設やアウトレットモールなどに行ったり、といった生活をしている。</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="ja" dir="ltr">今年度は娘の小学校送り迎え（学区が変わっても元の学校に通うのに送り迎えするのが条件だった）、三男の学童保育お迎え、四男の保育園送り迎えがあったけど、来年度から送り迎えが一切なくなるので、帰りの時間をあまり気にせずに平日に妻とデートできる。</p>&mdash; Gosuke Miyashita (@gosukenator) <a href="https://twitter.com/gosukenator/status/847741121409163266">March 31, 2017</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>自分は業務委託だから自由にやらせてもらってる面はあるけど、ATL は社員の人でも勤務時間などはわりと自由っぽい。自分は15時頃にミーティングが終わるとすぐに帰っているけど、takahi-i さんもお子さんを保育園に迎えに行くために一緒に帰ることがよくあった。</p>

<p>リクルートテクノロジーズの ATL、<a href="http://atl.recruit-tech.co.jp/recruit/">エンジニア募集</a> してるので、興味があればぜひどうぞ。</p>

<hr>

<h2>お金について</h2>

<p>みんな大好きお金の話。</p>

<p>法人登記しても働き方は変わらない、と冒頭に書いたが、お金の流れ的な面は色々変わった。</p>

<p>個人事業主の時は、売上げがすべて個人としての収入になっていたが、今は法人の方に売上が入り、そのうちの一部を役員報酬として自分に支払っている。</p>

<p>2015年はすべて個人事業主としての売上だったのが、2016年は1月〜3月は個人事業主（2月に登記して、契約を個人から法人に切り替えたのが4月からなので）、4月〜12月は法人の売上という構成になっている。2017年はほぼ100%法人の売上になるはず（オライリー本の印税など一部は個人の売上）。</p>

<p>2016年の個人と法人のトータルの売上は、2015年の個人の売上より1割増しぐらいだが、法人化したことにより、個人の所得税は半分以下になったし、これに法人所得税を加えても、2015年分の個人の所得税より4割ぐらい少ない。個人の住民税も半分ぐらいになるので、法人化による節税効果は大きい。</p>

<p>個人事業主の時は、所得税は確定申告で一年分をまとめて支払うし、住民税は年4回にわけて支払っていた。所得税には予定納税という仕組みがあるので、2年目以降は年3回に分けて支払う形になるが、予定納税額は前年の所得によって決まるので、収入が前年より大幅に増えると、予定納税で納める額よりも、確定申告後に支払う額がかなり大きくなるので、結局一年分まとめて支払うのと変わらないことになる（なった）。なので、いつどれぐらいお金が出ていくか、ということを意識しながら家計の支出をコントロールしないといけない。昨年は2月に家が完成して、ハウスメーカーに残額の支払いをしたり、引越をしたり、原状回復費用を支払ったり、家具を揃えたり、長男が高校に入学したり、という状況で多額の所得税を支払わないといけなかったので、キャッシュフローの管理にはかなり気をつかった。</p>

<p>法人化すると、所得税と住民税は役員報酬から毎月自動的に引かれる（住民税は特別徴収の手続きが必要だけど）。なので特定の月だけ多額の出費がある、ということがなく、キャッシュフローをそれほど気にしなくて良いので、精神的に楽。といっても、2016年は1月〜3月分の収入は個人事業主としての売上なので、確定申告による所得税の支払いまだあるし、子供達が小・中・高同時入学という状況なので、昨年ほどではないけど、3月4月の出費に備えてキャッシュフローを意識しないといけなかった。来年の確定申告は逆に還付を受ける立場になるので、キャッシュフローをきちんと管理しないと破滅する、ということはまずなさそうなので、とても気楽だ。</p>

<p>また住民税は、自治体によるのかもしれないが、普通徴収だと1月末が最終支払い月だが、特別徴収だと6月が最終支払い月なので、支払いを5ヶ月先延ばしにできることになる。これもキャッシュフロー的にはとても助かる。</p>

<p>他に法人化によってお金まわりで変わったのは、健康保険と年金。法人は社会保険に加入しないといけないので、国保＋国民年金から協会けんぽ＋厚生年金に切り替わった。国保と国民年金は100%個人が支払うけど、社会保険は会社と折半になる。健康保険の個人負担分は国保の時と金額それほど変わらないし、厚生年金の個人負担は国民年金の2.5倍ぐらいある。しかも、半分会社負担といっても、その会社の売上は結局自分が働いて得たお金なので、社会保険による出費は個人事業主と比べるとかなり大きい。とは言え、法人化による節税効果の方が自分の場合は大きい。フリーランスで個人か法人かを検討する際は、税金だけでなく社会保険も考慮しないといけない。自分はあまりこの辺は意識していなかった。社会保険料は役員報酬や給与の金額に応じて変わるので、調整の余地はありそう。国保の保険証は紙でペラペラだったけど、協会けんぽのはプラスチック製なので、その点は良い。</p>

<p>経費の使い方、という点でも、個人事業主の時とでは意識が変わる。個人の時は、経費と言えども出所は家計と同一なので、特に高額な出費の場合、多少躊躇いながら使っていた。今は、会社のお金と個人のお金が明確に区分されているので、経費を使うのにあまり躊躇いがない。躊躇うことがあるとすれば、金額の問題というよりも、一括減価償却できるかどうか、という観点で躊躇う。会社のお金と個人のお金が分かれているといっても、結局は自分のお金なので、あまり使いすぎると自分の首を絞めることになるけど。</p>

<hr>

<h2>まとめ</h2>

<p>フリーランスになって○年エントリ、今回で3回目になる。そろそろみんな飽きてきたのではないか、というか自分が書くの飽きてきたので、今回は書こうかどうか迷ったけど、個人事業主から法人化という変化を経験したので、それについてメモしておくのは意味があるかな、と思ったので書くことにした。</p>

<p>それと ATL の宣伝目的。<a href="http://atl.recruit-tech.co.jp/">リクルートテクノロジーズ ATL</a> では <a href="http://atl.recruit-tech.co.jp/recruit/">エンジニア募集中</a> です。</p>

]]></content>
  </entry>

  <entry>
    <title type="html"><![CDATA[Infrastructure as Code 本の日本語版出ます]]></title>
    <link href="http://mizzy.org/blog/2017/03/17/1/" />
    <updated>2017-03-17T12:00:00+09:00</updated>
    <id>http://mizzy.org/blog/2017/03/17/1/</id>
    <content type="html"><![CDATA[
<p><img src="/images/2017/03/iac.jpg" alt=""></p>

<p>監訳者なので5冊もらった。帯で名前が隠れているので、左下2冊は帯を外した状態。右下2冊は原著。なぜ2冊あるかというと、自分で買ったものと、監訳作業用にもらったものがあるから。</p>

<p>発売日は3/18ですが、既に先行販売してる書店とかあるかも。あと、電書版はまだないですが、オライリーさんのいつものパターンだと、間もなく電書版も出るはず。</p>

<ul>
<li><a href="https://www.oreilly.co.jp/books/9784873117966/">O&#39;Reilly Japan の紹介ページ</a></li>
<li><a href="https://www.amazon.co.jp/dp/4873117968">Amazon の商品ページ</a></li>
</ul>

<p>翻訳は数々の技術書、例えば最近だと、<a href="https://www.amazon.co.jp/dp/4873117380">入門 Python 3</a> とか <a href="https://www.amazon.co.jp/dp/4822251551">SOFT SKILLS</a> とか <a href="https://www.amazon.co.jp/dp/4873117909">詳解 システム・パフォーマンス</a> などを翻訳されている、<a href="https://www.amazon.co.jp/%E9%95%B7%E5%B0%BE-%E9%AB%98%E5%BC%98/e/B00D7GBFIU/">長尾 高弘</a> さんです。</p>

<p>どんな本かというと、オライリージャパンのサイトにある紹介文を引用すると、こんな感じです。</p>

<blockquote>
<p>Infrastructure as Codeは自動化、バージョン管理、テスト、継続的インテグレーションといった、ソフトウェア開発のプラクティスをシステム管理に応用するための方法論です。本書は、はじめにInfrastructure as Codeの原則と考え方を説明し、次にダイナミックインフラストラクチャプラットフォーム、インフラストラクチャ定義ツール、サーバ構成ツール、インフラストラクチャサービスの4つにカテゴライズして解説します。その上で、プロビジョニングやサーバーテンプレート管理のパターンから、テスト、変更管理パイプライン、組織やワークフローのプラクティスまでを詳述しており、Infrastructure as Codeを網羅的に理解することができます。各ツールの使い方よりも、背景にあるコンセプトや考え方の説明に重点を置くことで、特定のツールに縛られることなく、Infrastructure as Codeを適切に実現することを目指す本書は、エンジニアおよびマネージャ必読の一冊です。</p>
</blockquote>

<p>監訳者の仕事として、翻訳者さんが翻訳されたものに対して、よりわかりやすい表現に変えたり、より（自分にとって）馴染みのある言葉に変えたり、よりスムーズに頭に入るように文章を変えたり、といったことをしました。わかりやすくするために、敢えて原文から少し外れた文章にする、といったこともしています。もし文中でわかりにくい表現やスムーズに頭に入ってこない文章などがあったら、それは自分の監訳が至らないためです。ごめんなさい。</p>

<p>監訳作業の中で、ひとつ大きく言葉を変えたのは「Cycle Time」です。これはそのまま訳すと「サイクルタイム」ですが、「リードタイム」と訳しています。というのも、原著の「Cycle Time」は <a href="https://www.amazon.co.jp/dp/487311764X">カンバン仕事術</a> 内の「リードタイム」と同じ意味で使われていて、カンバン仕事術内の「サイクルタイム」とは別の意味になっているからです。最初は「サイクルタイム」のままにして監訳者注を入れる形にしたのですが、何カ所かこの言葉が出てくるところがあるため、注は入れずにすべて「リードタイム」に置き換えました。本書内では特に注がないため、原著と読み比べた方はおや、と思うかもしれないので、ここで触れておきます。</p>

<p>他にも、補足を入れたいところに監訳者注を入れたり、タイトルをどうするか（日本語に訳すのか、英語そのままにするのか、あるいは違うタイトルにするのか、何か言葉を付け加えるのか）、サブタイトルをどうするか、紹介文や帯文をどうするか、といったあたりを、編集の方と一緒に考えたり、といったこともやりました。</p>

<p>監訳者まえがきも書いています。当然原著には監訳者まえがきはありませんので、原著を読まれた方も、ぜひ日本語版も読んでみてください。</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="ja" dir="ltr">監訳者まえがきの最後の一文がとてもよい</p>&mdash; ゆううき (@y_uuk1) <a href="https://twitter.com/y_uuk1/status/842227662072438784">March 16, 2017</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>あわせて読みたい: <a href="http://mizzy.org/blog/2016/04/22/1/">Infrastructure as Code 再考</a></p>

]]></content>
  </entry>

  <entry>
    <title type="html"><![CDATA[フリーランス2年目だけど家を建てることにした 其の6]]></title>
    <link href="http://mizzy.org/blog/2016/09/26/1/" />
    <updated>2016-09-26T20:25:51+09:00</updated>
    <id>http://mizzy.org/blog/2016/09/26/1/</id>
    <content type="html"><![CDATA[
<p><a href="/blog/2016/01/15/1/">前回</a> からだいぶ間があいてしまった。書くの結構大変だし飽きたので。たぶん今回が最後。こことは別に <a href="http://mizzy.hateblo.jp/">フリーランスの家づくり日記</a> というブログがあって、今後はそちらだけ更新する予定。（mizzy.org の方は、家を建てることにまつわる経緯とか一連の流れとか手続きとかの話がメインで、mizzy.hateblo.jp の方は、家の工事過程とか外観とか内装とか家具とかの写真がメイン、という使い分けをしてる。）</p>

<p>今回は不動産取得税の話。固定資産税の存在は知ってたけど、不動産取得税は知らなくて、いきなり20万円超の納税通知書が届いて驚いた。同じように知らない人がいそうなので、ここにメモしておく。</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="ja" dir="ltr">不動産取得税なんてものがあるのか…しかも結構な金額だ…これはノーマークだった…</p>&mdash; Gosuke Miyashita (@gosukenator) <a href="https://twitter.com/gosukenator/status/676678448824213504">December 15, 2015</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2>土地の不動産取得税</h2>

<p>土地を取得すると、特に何もしなくても、都道府県税事務所から納税通知書が送られてくる。取得後どれぐらい経つと送られてくるのかは、自治体によって違う模様。「半年〜一年半後」といった説明を見かけたけど、自分の場合、5ヶ月ぐらいで送られてきた。なので、確実に知りたい場合には、管轄の都道府県税事務所に問い合わせるのが良さそう。</p>

<p>自分が土地を所有している神奈川県の<a href="http://www.pref.kanagawa.jp/cnt/f520239/p13774.html#sinkoku">県税事務所ウェブサイト</a> を見ると、「不動産を取得した日から10日以内に申告」と書かれているけど、特に申告は必要ないみたい。これも不安なら管轄の都道府県税事務所に問い合わせましょう。</p>

<p>自分は、納税通知書が送られてくるまで、この税の存在をまったく知らなかった。完全に予算外の出費。ハウスメーカーも不動産屋も特に教えてくれなかったし。しかも、金額がそこそこ大きい（自分の場合は20万円強の課税）ので、家を建てる方は念頭に置いておいた方が良い。ただし、後述するように、徴収の猶予を申請することもできる。</p>

<h2>家屋の不動産取得税</h2>

<p>土地の不動産取得税は、申告しなくても納税通知書が送られてきた。家屋の方も通知書が届くのを待てば良いか、と思っていた。けれど、半年経っても送られてこないので、県税事務所に問い合わせてみたところ、以下の回答をもらった。</p>

<ul>
<li>家屋の方も特に申告の必要はなく、通知書が届くのを待っていれば良い。</li>
<li>ほとんどのケースでは税額が0円になり、その場合は通知書は届かない。

<ul>
<li>我が家の面積だと、もしかしたら0円にならないかも、微妙なラインと言われた。</li>
</ul></li>
<li>通知書が届くとしても翌年になる。</li>
</ul>

<h2>土地の不動産取得税の軽減措置</h2>

<p>不動産取得税には軽減措置があって、土地の場合、その上で建物を新築すると、控除が受けられる。ケースバイケースだけど、全額戻ってくる場合がほとんどらしい。</p>

<p>軽減措置を受けるためには家が建ったことを証明する書類（検査済証や全部事項証明書など）が必要。なので、自分のように家が建つ前に土地の不動産取得税を納めるようなケースでは、一旦納税した後に、軽減措置の申告をして還付を受ける形になる。</p>

<p>軽減措置の申告については、こちらからアクションを起こす必要がある。自分の場合は、神奈川県税事務所に電話で問い合わせたら、詳しく丁寧に説明してくれ、必要な書類を郵送してもらえた。申告書はウェブサイトからもダウンロードできるけど、電話で問い合わせて郵送してもらうと、記入が必要な部分に印をつけてくれたり、こちらで用意する必要がある書類を蛍光ペンでマーキングしてくれたりするので、わかりやすい。担当者にもよるのかもしれないけど。</p>

<p>添付が必要な書類は、自分の場合は、家屋の全部事項証明書または建築基準法の検査済証と、家が建った後に発行された土地の全部事項証明書の2つだった。</p>

<p>全部事項証明書は原本が必要で、検査済証はコピーでも良い。家屋の方は手元に検査済証があるので、それのコピーを添付した。</p>

<p>土地の全部事項証明書は <a href="http://www.touki-kyoutaku-online.moj.go.jp/toukinet/top.html">登記ねっと</a> で申請して郵送してもらった。オンラインなのに平日の8:30-21:00しか受け付けてないけど、紙に記入するよりは楽だし、郵送の手数料は窓口受取より20円高いだけだし、手数料もオンラインで納付できるし、申請の翌々日には届いたので、オススメできる。</p>

<p>必要な書類が揃ったら、都道府県税事務所に郵送するか持参する。</p>

<p>その後、「不動産減額（免除）通知書」が県税事務所から届き、全額還付されることがわかった（届いたのが、申請書を送った2日後と、とても早い対応だった）。</p>

<p>通知書が届いてから20日ほど経って、申請した口座に還付金が振り込まれた。</p>

<p>自分はこのように、一度支払ってから還付という形をとったけど、徴収の猶予を申請することもできる。申請が通れば、通常は2年間の猶予がもらえるので、軽減措置と併せることで、一円も支払わずに済ませることができる。申請の手間はかかるけど、すぐに支払う余裕がない、という場合には、申請すると良さそう。</p>

<h2>家屋の不動産取得税の軽減措置</h2>

<p>土地の場合、上で書いたように、課税された段階では軽減措置の条件を満たしておらず、後から申告して還付してもらう、という形だったので、軽減措置があること、申告が必要なことを知っておく必要がある。</p>

<p>家屋の場合は、課税段階で軽減措置の条件も含めて計算してくれるので、特に知っておく必要はなさそう。</p>

<h2>まとめ</h2>

<ul>
<li>土地や家屋を取得すると不動産取得税が課される。</li>
<li>取得したことを申告する必要は特になく、納税通知書が送られてくるのを待てば良い。</li>
<li>課税額が0円の場合は納税通知書は送られてこない。

<ul>
<li>家屋の場合はこのケースが多い。</li>
</ul></li>
<li>土地の不動産取得税は、その土地で家を建てると軽減措置が受けられる。</li>
<li>軽減措置を受けるには、家が建ったことを証明する書類が必要。なので、課税段階でまだ建て終わってなければ、一度納税して、後から軽減措置の申告を行い還付してもらう必要がある。

<ul>
<li>または徴収猶予を申請することで、支払いしない（当然還付もされない）という方法も選択できる。</li>
</ul></li>
<li>不動産取得税の管轄は都道府県税事務所なので、気になることがあれば直接問い合わせるのが良い。

<ul>
<li>質問サイト等で質問してる人がいるけど、直接問い合わせる方が早いし確実。</li>
</ul></li>
</ul>

]]></content>
  </entry>

  <entry>
    <title type="html"><![CDATA[Infrastructure as Code 再考]]></title>
    <link href="http://mizzy.org/blog/2016/04/22/1/" />
    <updated>2016-04-22T09:00:00+09:00</updated>
    <id>http://mizzy.org/blog/2016/04/22/1/</id>
    <content type="html"><![CDATA[
<p>Infrastructure as Code という言葉が現れてから少なくとも8年ほど経過しており、この言葉もすっかり定着したように見えるが、<a href="https://www.thoughtworks.com/profiles/martin-fowler">Martin Fowler</a> 氏が最近自身のブログで <a href="http://martinfowler.com/bliki/InfrastructureAsCode.html">Infrastructure as Code について触れており</a> 、また、氏の同僚である <a href="https://www.thoughtworks.com/profiles/kief-morris">Kief Morris</a> 氏が O&#39;Reilly Media から <a href="http://shop.oreilly.com/product/0636920039297.do">Infrastructure as Code という本を出す</a>（現在 Early Relase 版や <a href="https://info.thoughtworks.com/Infrastructure-as-Code-Kief-Morris.html">Free Chapters</a> が入手できる）ようなので、このタイミングで改めて Infrastructure as Code について、その歴史を振り返るとともに、現在の状況について整理してみようと思い、このエントリを書くことにした。</p>

<p>内容的には、以前書いた <a href="http://mizzy.org/blog/2013/10/29/1/">インフラ系技術の流れ</a> と若干重複してる部分もある。</p>

<p>そういえば日本でも最近、<a href="http://gihyo.jp/book/2016/978-4-7741-7993-3">サーバ/インフラエンジニア養成読本 DevOps編 [Infrastructure as Code を実践するノウハウが満載! ]</a> というムック本が出ていますね。</p>

<hr>

<h2>Infrastructure as Code とは</h2>

<p>Infrastructure as Code が何かについては、既に色んな人が色んなところで語っているので、ここでは詳しくは説明しない。簡単に言えば「インフラ」をコードで記述することによって、ソフトウェアシステムで既に有効であると立証されているプラクティスを、インフラにも同じように適用でき、その恩恵が受けられる、というもの。</p>

<p>このプラクティスには次のようなものがある。</p>

<ul>
<li>バージョン管理</li>
<li>繰り返し可能なビルド</li>
<li>テスト</li>
<li>継続的インテグレーション</li>
<li>継続的デプロイ</li>
</ul>

<p>とは言え、最初から Infrastructure as Code がこのように解釈されていたわけではなく、その意味合いは時が経つとともに変遷している。</p>

<hr>

<h2>Infrastructure as Code の歴史と変遷</h2>

<p>Infrastructure as Code という言葉が現れ、今のように定着するようになるまでの大まかな流れを振り返ると、その起源は1993年に登場した <a href="https://cfengine.com/">CFEngine</a> にまで遡れる。もちろん当時は Infrastructure as Code という言葉はなかったが、<a href="https://puppet.com/">Puppet</a> や <a href="https://www.chef.io/">Chef</a> といった Configuration Management Tools と呼ばれるものの元祖であり、現在の Infrastructure as Code の流れに与えた影響は大きい。</p>

<p>Infrastructure as Code という言葉の大元の出自は調べてみてもわからなかったが、2005年に Puppet が登場したことが、この言葉が現れる直接のきっかけになったと思われる。</p>

<p>Chef がきっかけじゃないの？と思う人がいるかもしれない。Infrastructure as Code という言葉がどのタイミングで現れたのか調べてみると、一番古い資料では、現在 Chef 社の CTO である <a href="https://twitter.com/adamhjk">Adam Jacob</a> 氏 が、2008年4月25日に公開したスライド <a href="http://www.slideshare.net/adamhjk/why-startups-need-automated-infrastructures/24-Steps_to_Launch_Configuration_Management">Why Startups Need Automated Infrastructures の 24ページ目</a> が見つかる。</p>

<p>しかし、Chef のリリースは2009年であり、このスライドには Puppet は載っているけれど Chef は載っていない。また、Adam Jcob 氏の所属が HJK Solutions となっており、Chef 社の前身である Opscode 社を立ち上げる前であることが窺える。</p>

<p>なので流れ的には、CFEngine の影響を受けた Puppet が登場 → Puppet が広く受け入れられる → Puppet のような Configuration Management 手法を Infrastructure as Code と呼ぼうと誰かが言った（もしかして Adam Jcob 氏？） → Puppet Alternative として Adam Jcob 氏が Chef を開発した、といった感じなのではないかと。</p>

<p>Chefの <a href="https://github.com/chef/chef/commit/b5117775e86cff40399187b6292c98fba9dc5034">Initial Commit が 2008年3月6日</a> で、上記スライドを公開する少し前なので、Infrastructure as Code という言葉の発案者が Adam Jcob 氏だとすると、この言葉を思いついたのと、Chef（最初は Marionette という名前だった）の着想を得て開発を始めたのはほぼ同じ頃かもしれない。</p>

<p>英語版が2010年6月、日本語版が2011年5月に出版された書籍『<a href="http://www.oreilly.co.jp/books/9784873114934/">ウェブオペレーション</a>』で、Adam Jacob 氏は Infrastructure as Code を「ソースコードリポジトリ・アプリケーションデータのバックアップ・サーバリソースからビジネスを復旧できるようにすること」と述べており、当時はディザスタリカバリ的な視点から Infrastructure as Code を捉えていたようだ。</p>

<p>ちなみに、以下は ChefConf 2014 で Adam Jcob 氏と撮影したツーショット写真。</p>

<p><img src="https://pbs.twimg.com/media/BxzvOikCIAEcTGR.jpg:large" alt=""></p>

<p>ただ、Adam Jcob 氏のスライドのタイトルには「Automated」とある通り、Infrastructure as Code のメリットは、当初は「自動化」に焦点が当てられていたものと思われる。</p>

<p>それが現在のように、ソフトウェアシステムのプラクティスをインフラに適用する、という意味合いに変化したのは、DevOps という考え方と結びついたためだろう。</p>

<p>DevOps という言葉は、<a href="http://www.jedi.be/">Patrick Debois</a> 氏が主催した <a href="http://www.devopsdays.org/events/2009-ghent/">Devopsdays Ghent 2009</a> が発端であり、同氏は Agile 2008 Conference で <a href="http://www.jedi.be/presentations/IEEE-Agile-Infrastructure.pdf">Agile infrastructures and operations: how infra-gike are you? (PDF)</a> という発表を行っている。このことからも、DevOps はアジャイルの流れを汲んでいることが窺える。なので、Infrastructure as Code が DevOps と結びついてきた結果、アジャイル的なプラクティスをインフラにも適用する、という流れが生まれたのだと思われる。</p>

<p>Infrastructure as Code という言葉の出始めは2008年、DevOps は2009年だが、2009年当時にすぐに Infrastructure as Code が DevOps と結びついて今のような意味合いとなったわけではない。2009年6月に公開されたスライド <a href="http://www.slideshare.net/jallspaw/10-deploys-per-day-dev-and-ops-cooperation-at-flickr/22-CFengineChef_BCfg2_FAI1_Automated_infrastructure">10+ Deploys Per Day: Dev and Ops Cooperation at Flickr の22ページ目</a> でも「Automated infrastructure」とあることから、この当時もまだ、主にインフラの自動化に焦点が当てられていたようだ。</p>

<p>単なる自動化から、ソフトウェアシステムのプラクティス適用、という流れに変わったのは、2011年6月に O&#39;Reilly Media から出た <a href="http://shop.oreilly.com/product/0636920020042.do">Test-Driven Infrastructure with Chef</a> がきっかけだと思われる（ちなみに現在は <a href="http://shop.oreilly.com/product/0636920030973.do">第二版</a> が出ている）。この本が「Test-Driven Infrastructure」という具体的なプラクティスが認知され広まるきっかけとなったのだろう。</p>

<p>「テスト駆動」という具体的なプラクティスが登場したことにより、「継続的インテグレーション」や「継続的デプロイ」といった他のプラクティスにも広がっていき、Infrastructure as Code が今のような意味合いとして捉えられるようになっていった。</p>

<p>2013年3月に登場した <a href="http://serverspec.org/">Serverspec</a> もこの流れを加速するのに一役買っている。</p>

<hr>

<h2>Infrastructure as Code の適用領域</h2>

<p><a href="http://mizzy.org/blog/2013/10/29/1/">インフラ系技術の流れ</a> では、サーバプロビジョニングの領域を、次の3つにわける考え方を紹介した。</p>

<ul>
<li>Orchestration</li>
<li>Configuration</li>
<li>Bootstrapping</li>
</ul>

<p>Infrastructure as Code は元々、CFEngine の影響を受けた Puppet が登場した流れから出てきた言葉であり、CFEngine も Puppet も Configuration レイヤーに該当するツールである。したがって Infrastructure as Code の対象領域は Configuration レイヤーであり、代表的なツールと言えば Puppet や Chef であった。実際、Infrastructure as Code という言葉を聞くと、真っ先に思い浮かぶのは Chef、という方が多いのではないだろうか。</p>

<p>ところが最近では、Bootstrapping の領域も Infrastructure as Code の対象範囲に含まれている。</p>

<p><a href="https://aws.amazon.com/jp/ec2/">Amazon EC2</a> のような、API でプログラマブルに扱える IaaS は結構前からある（確か EC2 登場は2006年）が、インフラをコードでプログラマブルに扱えるから Infrastructure as Code だ、という見方はあまりなかったように思われる。</p>

<p>その状況が変わったのはおそらく、<a href="https://www.terraform.io/">Terraform</a> や <a href="https://aws.amazon.com/jp/cloudformation/">CloudFormation</a> といった、API を直接操作することなく、何らかの簡易的な言語によって IaaS を操作できるツールやサービスが登場したことが影響しているだろう。</p>

<p>ちなみに、以下は Terraform を開発している <a href="https://www.hashicorp.com/">HashiCorp</a> 社の CEO <a href="https://twitter.com/mitchellh">Mitchell Hashimoto</a> 氏と撮影したツーショット写真。</p>

<p><img src="/images/2016/04/mhashimoto.png" style="width: 600px;" /></p>

<p>また、単なるインフラ管理の自動化から、ソフトウェアシステムにおけるプラクティスの応用、と意味合いが変わるにつれ、Infrastructure as Code と聞いて想起するものが、Puppet, Chef, Terraform といった、インフラをコードで記述するツールだけではなく、<a href="http://kitchen.ci/">Test Kitchen</a> や <a href="http://serverspec.org/">Serverspec</a>、<a href="https://jenkins.io/">Jenkins</a> や <a href="https://circleci.com/">CircleCI</a> といった、Infrastructure as Code のプラクティスを支えるツールやサービスなど、多岐に渡るようになってきている。</p>

<p>Configuration Management を対象としていた Infrastructure as Code が、更に低いレイヤー、よりインフラと呼ぶにふさわしい領域も含むようになったことで、元々 Infrastructure as Code が対象としていた領域については、 Configuration as Code と呼び分けた方が良いのでは、といった議論も最近は出てきている。</p>

<p>が、現在使われている「インフラ」という言葉の指す範囲は広く、Configuration Management が対象とする領域も含まれているし、元々 Configuration をメインの対象としてい た Infrastructure as Code を Configuration as Code に変え、その下のレイヤーだけを Infrastructure as Code と呼ぶ、というのは、混乱を招きそう。</p>

<p>また、Configuration as Code の字面だけを見ると、設定内容をコードで書く（例: Nginx の設定を mruby で書く）ことを自分は想起する。</p>

<p>なにより、Infrastructure as Code は、ソフトウェアシステムのプラクティスを、今まで適用範囲外だと思われていた領域に適用する、というパラダイムを表す言葉として重要なのであって、その中でレイヤーを厳密に細分化して区別する意味合いは薄いと思われる。</p>

<hr>

<h2>Infrastructure as Code に関連するツールやサービスの分類</h2>

<p>書籍『<a href="http://shop.oreilly.com/product/0636920039297.do">Infrastructure as Code</a>』では、Infrastructure as Code に関連するツールやサービスを次の4つのグループに分類している。</p>

<ul>
<li>Dynamic Infrastructure Platforms

<ul>
<li>EC2 のような IaaS や <a href="https://www.openstack.org/">OpenStack</a> のような IaaS を構成するためのツール</li>
</ul></li>
<li>Infrastructure Orchestration Tools

<ul>
<li>Terraform や CloudFormation のような、IaaS 上でサーバ/ネットワーク/ストレージといったリソースを制御するためのツールやサービス</li>
<li><a href="https://www.consul.io/">Consul</a>, <a href="https://coreos.com/etcd/">etcd</a>, <a href="https://zookeeper.apache.org/">ZooKeeper</a> のような Configuration Registry</li>
</ul></li>
<li>Server Configuration Tools

<ul>
<li>Puppet, Chef, <a href="https://www.ansible.com/">Ansible</a>, <a href="https://github.com/itamae-kitchen/itamae">Itamae</a> といったリソースの設定を行うためのツール</li>
</ul></li>
<li>Infrastructure Services

<ul>
<li>プロビジョニングしたインフラを管理するためのツール</li>
<li>モニタリング、サービスディスカバリ、プロセス・ジョブ管理、ソフトウェアデプロイメントなど</li>
</ul></li>
</ul>

<p>前項で、Infrastructure as Code と Configuration as Code を分離する意味はあまりない、と述べたが、ツールをこのように分類するのは、各ツールの役割がイメージしやすいし、Infrastructure as Code のライフサイクルを整理したり、各フェーズについて議論したりするのには有用そうだ。</p>

<p>Dynamic Infrastucture Platforms の上で、Infrastructure Orchestration Tools によりサーバ/ネットワーク/ストレージといったリソースの割り当てを行い、Server Configuration Tools でそれらリソースの設定を行う。そして Infrastructure Services によってリソースを管理する。というのがざっくりとした流れ。</p>

<p>この中で Infrastructure as Code 的な手法が適用できるツールが揃っているのは、今のところ Infrastructure Orchestration Tools と Server Configuration Tools ぐらいか。</p>

<p>Dynamic Infrastructure はその名の通り基盤であり、その上でリソースをコントロールするツールは Infrastructure Orchestration に属するので、Dynamic Infrastruture Tools に属する Infrastructure as Code なツールがないのはある意味当然かな、と。</p>

<p>Infrastructure Services はその性質上、静的なコードを記述して制御する、というよりも、Infrastructure Orchestration Tools や Server Configuration Tools と連動して動的に何かを行う、というものが多そうなので、Infrastructure as Code なツールがあまりないのはそのためかも。今後、この辺りで Infrasturcture as Code 的なツールや手法がどう発展していくのかが気になる。あるいは発展しないかも。</p>

<hr>

<h2>Infrastructure as Code に関するイベントやります</h2>

<p>最初に触れたように、Martin Fowler 氏がブログでとりあげたり、O&#39;Reilly から書籍が出る、ということもあって、改めて Infrastructure as Code について振り返って現状整理してみた。整理はしてみたものの、この先どうなっていくのか、といったことはまだ十分考察できていないし、一人で考えていても煮詰まりそうなので、Infrastructure as Code をテーマにしたイベントでもやろうかと考えている。</p>

<p><a href="http://www.zusaar.com/event/11697003">Infrastructure as Code 現状確認会</a> というイベントが過去にあったので、これとは少し違う方向性で、ツールの話が主眼ではなく、もう少し大局的な視点から、Infrastructure as Code のこれまでとこれからについて語れるようなイベントを。</p>

<p>もし興味があったり、こんな話が聞きたい、などあれば、ブコメや Twitter などでお知らせ頂けるとありがたいです。</p>

]]></content>
  </entry>

  <entry>
    <title type="html"><![CDATA[フリーランスになって2年が経った]]></title>
    <link href="http://mizzy.org/blog/2016/04/01/1/" />
    <updated>2016-04-01T10:00:39+09:00</updated>
    <id>http://mizzy.org/blog/2016/04/01/1/</id>
    <content type="html"><![CDATA[
<blockquote class="twitter-tweet" data-lang="en"><p lang="ja" dir="ltr">株式会社はてなに入社しました。</p>&mdash; Gosuke Miyashita (@gosukenator) <a href="https://twitter.com/gosukenator/status/715555225566707712">March 31, 2016</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>↑はちょうど2年前の <a href="http://mizzy.org/blog/2014/04/01/1/">4月からクックパッドで仕事してます</a> と同様、エイプリルフールネタです（実際にありえそうなので判断に迷った人いそうだけど）。</p>

<p><a href="http://mizzy.org/blog/2015/04/01/1/">フリーランスになって1年が経った</a> というエントリを書いてからちょうど1年経ったので、この1年を振り返ってみる。</p>

<hr>

<h2>仕事について</h2>

<p>1年目は、元々正社員になる前提で、様子見ということでクックパッドと業務委託契約を結んでいたので、基本フルタイムコミットで決まった時間にオフィスで仕事、という形だったけど、2年目はオフィスに行く日数を減らしたり、リクルートテクノロジーズの仕事の割合を増やしたりした。</p>

<p>2年目の前半は、クックパッドの仕事が週4日で、そのうち2日はオフィスに行き、リクルートテクノロジーズの仕事は週1日リモートで、という感じだったけど、後半はクックパッドが週2日でうち1日はオフィス、リクルートテクノロジーズは週3日、そのうち隔週で（最初のうちは週1で）ミーティングのためにオフィスに行く以外はリモートで、という形になった。</p>

<p>リクルートテクノロジーズの方は、日数を増やしただけではなく、コミット度合いを深めるため、また、中の人として対外活動するために <a href="http://mizzy.org/blog/2015/10/01/1/">技術顧問という肩書きをもらった</a> 。</p>

<p>クックパッドとの業務委託契約はこの3月で満了となった。インフラCIをがっつりやらせてもらって知見を得ることができたし、<a href="https://github.com/itamae-kitchen/itamae">Itamae</a> の誕生にも貢献できて良かった。Itamae、ほんと良いツールなので、今後他社で仕事する時にも、隙あらば積極的に入れていきたい。</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="ja" dir="ltr">クックパッドは契約期間満了ってことで、餞別に薄くてかっこいい財布をいただきました。mirakui さんによるチョイス。ちょうど財布欲しいと思っていたところなので超うれしい。ありがとうございます！ <a href="https://t.co/ab4a0fDPsS">pic.twitter.com/ab4a0fDPsS</a></p>&mdash; Gosuke Miyashita (@gosukenator) <a href="https://twitter.com/gosukenator/status/715559613538566148">March 31, 2016</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>リクルートテクノロジーズの方は引き続き継続して、世の中に新しい価値観をもたらすような OSS の研究・開発をメインミッションとしてやっていく予定。Walter はとりあえず最低限のものはできた、と思っているので、今後はドキュメントの充実やリファクタリングや広報活動なんかをやりつつ、別の新しいOSSについて模索していきたい。</p>

<p>また、最近 <a href="https://sencorp.co.jp/">千株式会社</a> の技術顧問になった。ここは <a href="https://8122.jp/">はいチーズ！</a> という写真サービスを運営していて、お子さんをお持ちの方なら、このサービスを知っているかも。</p>

<p>これら以外には、単発でテスト駆動インフラに関する講師業をやったりした。</p>

<p>現在他にもいくつか、新規で話を進めている会社がある。現場感覚は鈍らないようにしたいので、実際に手を動かす仕事は今後もやっていきたいと思っている。もしそういうお仕事があればお声がけください。</p>

<p><a href="http://mizzy.org/blog/2015/04/01/1/">フリーランスになって1年が経った</a>  で、「年に一度は沖縄でリゾートワークしたり、子供達の夏休みにあわせて8月はまるっと休んだり、MGSV:TPP が発売される9月も休もうか、などと計画してる」と書いた件はどうなったかというと、沖縄でリゾートワークは  <a href="http://hackers-champloo.org/2015/">ハッカーズチャンプルー2015</a> に参加することで実現したけど、8月や9月に休むのは、事情により実現できなった。詳しくは後述。</p>

<hr>

<h2>収入について</h2>

<p>昨年の所得（売上ー経費）は、サラリーマン時代の最高年収の2.7倍ほどで、昨年4月時点での見通しよりも多かった。今年も同じぐらいかな、という見通しだけど、来年についてはどうなるかはさっぱりわからない。</p>

<hr>

<h2>家を建てた</h2>

<p>フリーランス関係ないじゃん、と思われそうだけど、実は大いに関係ある。ひとつは、収入が増えたことで、頭金をつくる余裕ができたこと。会社員時代の収入、決して少なくはなかったけど、子供5人いるとカツカツで、頭金を貯める余裕はなかった（節約が苦手、というのもあるけど）。</p>

<p>もうひとつは、電車通勤することが減り、土地を探すのに必ずしも駅の近くである必要がなくなったので、予算内で広めの土地を買うことができたこと。</p>

<p>8月9月に休むのをやめたのも、家を建てることになったからで、なるべく多く頭金に回したい、ということで、休まず働くことにした。</p>

<p>フリーランス2年目で、過去1年分の確定申告実績しかなかったので、ローン通るかは不安だったけど、そこは大丈夫だった（その辺については <a href="http://mizzy.org/blog/2015/12/13/1/">このエントリ</a> に書いた）。</p>

<p>収入が今後どうなるかわからないので、月々の返済額は、収入が現在の半分になっても無理なく支払えるぐらいの金額でローンを組んだ。</p>

<p>家で仕事するときはこんな感じでやっている。</p>

<p><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/M/MIZZY/20160310/20160310114651.jpg" alt=""></p>

<hr>

<h2>会社を設立した</h2>

<p>一定の収入を超えると、税制的に法人化した方がお得、という話をよく聞くけど、事務手続きとか色々めんどくさそうなので、多少税金を多く支払っても、楽な個人事業主で行こう、と思っていた。けれど、12月になって所得税を計算してみたら結構な額（30歳当時の年収ぐらい）になって、これは法人化して節税した方が良さそうだ、と思ったので、会社をつくることにした。</p>

<p>来年は消費税の課税対象事業者になるけど、法人化すればまた2年間は免税事業者でいられて、その点でも節税できるし。</p>

<p>というわけで、2月に合同会社Serverspec Operationsという会社を設立した。あくまでも節税のために法人化しただけで、個人事業主の延長なので、何か新しい事業をやる、というわけではないし、人を雇うとかはまったく考えていない。</p>

<hr>

<h2>まとめ</h2>

<p>相変わらず先行きわからない不安みたいのはあって、<a href="http://rebuild.fm/132/">Rebuild 132</a> のひげぽんさんのキャリアパスの話を大きく頷きながら聴いていた。とはいえ、会社員時代も、自分がやりたいことと会社でやるべきことが乖離していくことに対する不安や、いつまで技術者としてやっていけるんだろうか、という不安があったので、立場がどうなっても、不安はつきまとうものなんだろう。とりあえずは、フリーランスでやっていけなくなったら、また会社員に戻ればいいか、と考えている。</p>

]]></content>
  </entry>

  <entry>
    <title type="html"><![CDATA[フリーランス2年目だけど家を建てることにした 其の5]]></title>
    <link href="http://mizzy.org/blog/2016/01/15/1/" />
    <updated>2016-01-15T21:40:52+09:00</updated>
    <id>http://mizzy.org/blog/2016/01/15/1/</id>
    <content type="html"><![CDATA[
<p>ローンの仮審査も通って、資金面の目処がついたところで、次は土地探し。土地が決まらないと、その上に建てる家を具体的にどうするのか、話が進められないので。</p>

<p>といっても、土地探しから契約、決済まで、ハウスメーカーの担当営業が間に入って色々やってくれて、特に苦労したこととか、ハマったこととかもないので、<a href="http://www.amazon.co.jp/dp/B00ET0L78Q">マンガ はじめて家を建てました！</a> とか読んでもらった方が有益な情報が得られると思う。</p>

<hr>

<h2>土地の条件</h2>

<p>土地を探すにあたって、まずは条件を整理。我が家の場合は以下の3点について条件を設定した。</p>

<ul>
<li>通学区域</li>
<li>広さ</li>
<li>予算</li>
</ul>

<p>次男が絶対に転校したくない、と言うので、現在通っている中学校の通学区域内、というのが外せない条件のひとつ。通学区域は自治体のウェブサイトに載っているのでそれを参考にした。</p>

<p>広さについては、各ハウスメーカーと打ち合わせを進める中で、7人家族であれば家の広さは大体これぐらいは必要、というのが見えてきたので、その広さの家が建てられる土地、というのが条件。土地そのものの広さに加えて、<a href="https://ja.wikipedia.org/wiki/%E5%BB%BA%E3%81%BA%E3%81%84%E7%8E%87">建ぺい率</a>、<a href="https://ja.wikipedia.org/wiki/%E5%AE%B9%E7%A9%8D%E7%8E%87">容積率</a> というものを加味する必要がある。</p>

<p>他にも、<a href="https://ja.wikipedia.org/wiki/%E7%94%A8%E9%80%94%E5%9C%B0%E5%9F%9F">用途地域</a>、<a href="https://ja.wikipedia.org/wiki/%E6%96%9C%E7%B7%9A%E5%88%B6%E9%99%90">斜線制限</a>、<a href="https://ja.wikipedia.org/wiki/%E9%98%B2%E7%81%AB%E5%9C%B0%E5%9F%9F">防火地域</a> など、建てられる建物の大きさや高さ、使える部材等に影響する規制があるので、把握しておくと良い。防火地域の場合、窓や玄関ドアなどに使える部材が限られるし、値段も高くなる。</p>

<p>また、地盤が軟弱だと、地盤改良が必要になり、余分なお金が必要（延べ床面積30坪の2階建てで150万〜200万円くらい）になるので、候補の土地が見つかったら、不動産仲介業者に近隣の地盤データをとってもらうか、役所によっては自由に閲覧できるので、調べてみると良い。</p>

<p>予算については、不動産サイトで地域や広さを元に検索すれば、相場がなんとなく見えてくるので、その相場から大きく外れない範囲で設定する。</p>

<p>相場については、<a href="http://www.land.mlit.go.jp/webland/">国土交通省の土地総合情報システム</a> で調べることもできる。</p>

<p>その他色々条件はあるけど、必須ではなく、満たしてたら望ましいけど、満たしてなくても良い、という感じで土地を探した。例えば、駅は近い方がいいけど、普段電車を使うのは自分だけだし、家で仕事をしてることも多いので、多少遠くても構わない、ということにした。というか、土地探しの条件を緩和するために、リモートワークする日数を増やした、とも言える。</p>

<hr>

<h2>土地探し</h2>

<p>条件を決めたら実際に土地を探すわけだけど、基本的には妻にお任せ、という感じだった。妻は建設会社で働いていて、自分よりも土地情報にアクセスしやすいし、詳しいので。</p>

<p>自分は不動産情報アプリをいくつか入れて、条件を設定して、その条件にあった物件が出ると通知が来るので、それを眺めて、お、これ良さそう、と思ったら妻に見せ、うん、それもう知ってる、と言われる、というのを繰り返していた。</p>

<p>最初に、お、ここ良さそう、ここにしよう、と思った土地、駅が近いし予算内だし Ingress のポータルがスキャナ圏内ではあったけど、ハウスメーカーの担当営業にその土地上でプランをつくってもらったら、家を建てるのには十分な広さだけど、車を置くスペースがない、ということと、そもそも学区外だった、ということで却下。</p>

<p>で、次に良さそう、と思った土地は、ハウスメーカーの担当営業が、ここどうですか、と紹介してくれた土地で、妻も良さそうと思って目をつけていた土地だった。駅からは遠いけど、広さは十分だし、学区内だし、価格も予算をかなり下回っている。</p>

<p>また、南西側に6メートル幅の公道、車通りはそれほど多くない住宅街、区役所や税務署が近い、などなど、駅が遠いこと以外は申し分ないので、この土地で決定することに。</p>

<p>ただ、本当にいい土地を探したいのであれば、地場の不動産会社に足繁く通うのがいいらしい。我が家の場合も、すぐに見つからない場合には、この方法を採ろうと考えていた。</p>

<hr>

<h2>土地契約</h2>

<p>土地を決めたところで、不動産会社との交渉なんかはすべてハウスメーカーの担当営業にお任せした。なので、買い付けの連絡、指値交渉、契約日の調整などすべて担当営業にやってもらった。</p>

<p>土地の調査もハウスメーカー側ですぐにやってくれて、水道管が隣の敷地を通っているため、建築時に水道管の引き直しが必要になる、ということがわかった（費用は自腹）。それを材料に担当営業が指値交渉してくれて、100万円ほど値段が下がった。</p>

<p>また、買い付けから1週間ほどで契約、というのが普通らしいけれど、契約日は2週間後に伸ばすよう交渉してもらった。理由は忘れたけど、建物の契約やローンの本審査の絡みだったような気がする。</p>

<p>契約は、不動産会社のミーティングスペースで行った。その場にいたのは、売り主、売り主側の不動産会社担当営業、買い主である自分と妻、買い主側の不動産会社担当営業、ハウスメーカーの担当営業、の計6人。土地の契約は初めてのことで若干不安だったので、見知った顔（ハウスメーカー担当営業）があるのはありがたかった。</p>

<p>土地契約、以下のような書類の内容確認と、記名捺印を行う。全部で1時間半ぐらいかかったかな。</p>

<ul>
<li>不動産売買契約書</li>
<li>重要事項説明書</li>
<li>承諾書</li>
<li>一般媒介契約書</li>
</ul>

<p>上に書いたように、購入予定の土地に引き込まれている水道管が隣地を通っていて、それは引き直すのでいいんだけど、逆に隣地に引き込まれている水道管がこちらの土地を通っている、という状態にもなっている。これはすぐに引き直してもらうわけにもいかないので、後々トラブルになることを避けるために、隣地所有者との間で、建物の再構築の際には引き直してもらうこと、土地の所有者が変わった場合にも効力が及ぶこと、といった覚書を交わすことになった。覚書の作成や、隣地所有者とのやりとりは、すべて不動産会社がやってくれた。</p>

<p>他にも、隣地所有者一覧、隣地の登記情報、土地境界確認書などなど、たくさんの書類をもらった。</p>

<p>あと、手付金50万円をその場で現金で支払った。</p>

<p>この時点ではローンはまだ本審査中なんだけど、契約内容にローン特約というのが盛り込まれていて、ローンの審査に落ちた場合には、契約をすべて白紙に戻すことができ、手付金も戻ってくる。</p>

<hr>

<h2>土地決済</h2>

<p>契約の約1ヶ月後に決済を行った。決済時に行った内容は以下の通り。</p>

<ul>
<li>売り主へ土地代金の支払い（手付金分は除く）</li>
<li>不動産会社への仲介斡旋手数料の支払い（約3%）</li>
<li>売り主へ固定資産税等清算金の支払い</li>
<li>土地登記用書類の作成と司法書士事務所への登記費用の支払い</li>
</ul>

<p>決済に必要な書類の作成（振込用紙や登記用書類等の記入）は銀行のミーティングスペースを借りて行い、振込用紙への記入が終わったら、それを1階の窓口に持って行って売り主と不動産会社と司法書士事務所への口座へ振り込みを行う、という流れだった。</p>

<p>銀行によってはミーティングスペースを貸してくれず、その場合には書類作成を不動産会社のミーティングスペースで行って、その後銀行に移動して振り込みを行う、という流れになるそう。また、同じ銀行の支店違いの口座間の振り込みなので、それほど時間がかからないけど、違う銀行間だったりすると、金額が大きいため、かなり時間がかかるらしい。手続きを待っている間、不動産会社の担当営業から、そんな話を聞いた。</p>

<p>住宅ローンの融資を受けられるのは家が完成して引き渡された後なので、ハウスメーカーの系列会社からつなぎ融資で土地代金分を借りて支払った。自分の口座に数千万円のお金が振り込まれて、それがすぐなくなる、というなかなか得がたい経験をした。ちなみに、住宅ローンは自分の口座には振り込まれず、ハウスメーカーの口座に直接振り込まれる。</p>

<p>決済後、1，2週間後ぐらいで全部事項証明書が郵送されてきて、土地の所有権が自分に移転していることを確認した。</p>

<hr>

<h2>まとめ</h2>

<ul>
<li>あたりまえだけど、土地が決まらないと建物の話が具体的に進められない</li>
<li>土地の相場は <a href="http://www.land.mlit.go.jp/webland/">国土交通省の土地総合情報システム</a> で調べることができる</li>
<li>土地探しにあたって、各種規制などについて把握しておくと良いけど、不動産会社とかハウスメーカーの担当営業にわからないことは聞けばいいので、ざっくり把握するぐらいで OK</li>
<li>地盤が軟弱だと補強に結構なお金がかかるので要注意</li>
<li>土地探しは地場の不動産会社に足繁く通うのがいいらしい</li>
<li>大手ハウスメーカーだと、担当営業が土地探しを手伝ってくれたり、不動産会社との交渉をしてくれたり、土地の契約や決済も立ち会ってくれて楽</li>
<li>自分は、ハウスメーカーの担当営業に色々やってもらって苦労しておらず、有益なアドバイスはあまりできないので、<a href="http://www.amazon.co.jp/dp/B00ET0L78Q">マンガ はじめて家を建てました！</a> とか読んでもらった方が良い</li>
</ul>

]]></content>
  </entry>

  <entry>
    <title type="html"><![CDATA[フリーランス2年目だけど家を建てることにした 其の4]]></title>
    <link href="http://mizzy.org/blog/2015/12/13/1/" />
    <updated>2015-12-13T23:00:00+09:00</updated>
    <id>http://mizzy.org/blog/2015/12/13/1/</id>
    <content type="html"><![CDATA[
<p>今回は住宅ローンの話。</p>

<p>いつも通り、自分の場合はこうだった、という話であって、他の誰にも当てはまるわけではないし、特にお金に関しては杜撰なので、ここに書かれてる内容をあまり参考にしない方がいいです。</p>

<hr>

<h2>借入可能額を試算する</h2>

<p>家づくりを進めるにあたって、借入可能額＋頭金で、自分がどれぐらいの金額を出せるのかを把握しておくと、その後の話がスムーズに進むので、なるべく早い段階で把握しておきたい。</p>

<p>自分はスーモカウンターで試算方法を教えてもらい、2パターンの借入可能額の試算を行った。</p>

<p>ひとつは年収からどれぐらい借入ができるか（金融機関がどれぐらい貸してくれるか）を試算。もうひとつは、毎月の返済額からどれぐらい借入ができるかを試算。</p>

<p>「住宅ローン 返済シミュレーション」とかでググると、試算できるサイトが色々出てくるけど、金利とか返済負担率とか、慣れないと何を入れれば良いのかよくわからない部分があったりする。</p>

<p>というわけで、 <a href="http://www.flat35.com/">フラット35</a> のサイトでのシミュレーションを元に簡単に解説。</p>

<p>家を建てる予定がない人でも、試してみるとおもしろい、かも。</p>

<h3>年収に基づいた借入可能額</h3>

<p><a href="http://www.flat35.com/simulation/simu_03_2.html">年収から借入可能額を計算：【フラット35】</a>  で試算ができる。</p>

<p><img src="/images/2015/12/loan01.png" alt=""></p>

<p>「年収」の部分は、会社員であれば額面年収を入力する。自分のようなフリーランスの場合は、売上から経費を差し引いた所得を入力する。</p>

<p>「融資金利」は金融機関の審査では4％が一般的とのことなので、「4」と入力。</p>

<p>「返済期間」は特に決めていなければ35年でいいかと。</p>

<p>「返済方法」の「元利均等」と「元金均等」は、「元利均等」が一般的なので、わからなければ「元利均等」のままで。違いについて知りたい人は <a href="http://www.flat35.com/loan/atoz/1_4.html">1-5. 元利均等返済と元金均等返済とは？：長期固定金利住宅ローン 【フラット３５】</a> を参照。</p>

<p>更に下の方には、「他の借入金」という項目があるので、自動車ローンやキャッシングなどの借入がある場合は入力。</p>

<p>最後に「計算する」ボタンをクリックすれば、借入可能額が表示される。</p>

<p>借入可能額を試算する際、隠れパラメータとして「返済負担率（収入に占める返済額の割合）」がある。金融機関の審査では、一般的には年収400万円未満の場合は30％、400万円以上の場合には35％が使われるらしい。<a href="http://www.flat35.com/loan/flat35/outline.html">【フラット３５】のご利用条件：長期固定金利住宅ローン 【フラット３５】</a> でも同様の数字が定められている。この試算サイトでも、計算結果を見る限りではこの数値が使われてるっぽい。</p>

<h3>毎月の返済額に基づいた借入可能額</h3>

<p><a href="http://www.flat35.com/simulation/simu_02.html">毎月の返済額から借入可能金額を計算：【フラット35】</a> で試算ができる。</p>

<p><img src="/images/2015/12/loan02.png" alt=""></p>

<p>「毎月の返済額」には、これぐらいは出せるかな、という金額を入力。自分の場合は、元々賃貸物件を探していたので、想定していた家賃金額を入力して試算した。ただし、賃貸と違って、固定資産税や今後の修繕のための積立などが必要なので、賃貸で出せる家賃よりは少し抑えて入力した。</p>

<p>「融資金利」は、フラット35で借りる場合には、フォーム上にある「最新の金利情報」のリンクを開いて表示される金額を入力。これを書いている2015年12月現在だと1.550%。ただし、<a href="http://www.flat35.com/loan/flat35s/index.html">フラット35S</a> が適用できる場合までは考慮されていない。適用できる場合には、10年間（または5年間）は金利が0.6%引き下げられるので、試算額よりも更に多く借入ができる。</p>

<p>「返済期間」「返済方法」は、特に決めていなければ、35年、元利均等で。</p>

<p>金利については、変動金利もあれば、期間選択型とか色々あるし、借り換えとかも考慮すると、実際どれぐらいの金利を想定して試算すればよくわからん、となるけど、とりあえずざっくり試算するだけなら、フラット35の固定金利で試算しておけば良さそう。変動の方が金利が低いので、試算上の借入可能額は大きくなるけど、少なめに見積もった方が安全なので。</p>

<h3>どちらの金額を元に進めるか</h3>

<p>「年収に基づいた借入可能額」と「毎月の返済額に基づいた借入可能額」の2つの借入可能額を試算したわけだけど、今後家づくりを進めるにあたって、どちらの金額を元に進めていくか、を決める必要がある。</p>

<p>「年収に基づいた借入可能額」は金融機関による審査で借入ができる上限額の推定値、という性格もあるので、この金額以上には借入できない可能性が高い。したがって「年収に基づいた借入可能額 ＜ 毎月の返済額に基づいた借入可能額」の場合には、「年収に基づいた借入可能額」を元に進める。</p>

<p>「年収に基づいた借入可能額 ＞ 毎月の返済額に基づいた借入可能額」の場合には、どちらを採用してもいいけど、自分が現実的に返済できるであろう金額である「毎月の返済額に基づいた借入可能額」を元に進めた方が安全。</p>

<p>自分の場合は「毎月の返済額に基づいた借入可能額」で試算した額を上限として話を進めていった。</p>

<h3>ライフイベント表とキャッシュフロー表</h3>

<p>資金計画を立てるにあたって、今後の人生でどういった出来事が起こるか（出産、入学、車買い換え等）を表にしたライフイベント表と、その時々でどれぐらい収入や支出があるかを表にしたキャッシュフロー表をまずは作成する、というやり方もあるけど、自分はそこまではやっておらず、詳しくは知らないので、そういうやり方がある、という紹介だけに留めておく。</p>

<p>フリーランスだから、数年後の収入がどうなってるかなんて全然わからない、というのもあるけど、そもそも表をつくるのがめんどくさい。子供5人いるから、ライフイベントもその分多いし。</p>

<hr>

<h2>住宅ローンの仮審査</h2>

<p><a href="/blog/2015/11/04/1/">前回のエントリ</a> でハウスメーカー巡りをした際に、そのうちのいくつかでは、次回の打ち合わせでは住宅ローンの仮審査の申し込みをしましょう、これこれの書類の用意をお願いします、みたいな話になった。そりゃあ営業としては、こいつちゃんと支払いできるのか、ってのは早めに知りたいだろう。</p>

<p>実際、借入可能額を試算してみたわけだけど、本当にその金額を借入可能かどうかわからない。特にフリーランスで実績もほとんどないため、審査が通らない可能性も高い。</p>

<p>というわけで、前回のエントリで絞り込んだハウスメーカーに、仮審査の申し込みをお願いした。他のハウスメーカーとも打ち合わせした中で、土地と家でだいたいこれぐらいかな、とおおざっぱな金額感は把握できたので、その金額を元に「土地の金額＋家の金額ー頭金」で仮審査してもらうことにした。これは、試算した借入可能額よりは低い金額だけど、高すぎると審査通る可能性が更に低くなりそうだな、と思ったので、最低限必要になりそうな金額で申請することにした。</p>

<p>仮審査にあたって、都銀、地銀、信用金庫・ゆうちょ銀行、フラット35、それぞれについてまとめた1枚ペラの紙を担当営業が用意してくれた。以下、それからの抜粋。</p>

<h3>都銀</h3>

<p>自己資本比率が一番のポイント。借入額の1〜2割が必要。審査の見方は機械的。金利は比較的安く、銀行の窓口が多いので返済や使い勝手も良い。</p>

<h3>地銀</h3>

<p>自己資本比率は都銀と同じだけど、融通が利く可能性がある。安定性を証明できる資料、今年度の見込収支が説明できる資料があれば可能性は高まる。金利、サービスなどはコンビニのお陰で大きな差はなくなっている。</p>

<h3>信用金庫・ゆうちょ銀行</h3>

<p>自営業、個人事業主に強い商品を扱っている。審査が通る可能性が高い。金利は割高。</p>

<h3>フラット35</h3>

<p>国が支援する住宅ローン貸付、窓口は金融機関だが大本は住宅融資支援機構。審査は緩いが、勤続年数の長さは審査上見られ、信金系の次に可能性は高い。35年の長期固定が魅力。性能が高い住宅の場合は優遇もあり。</p>

<p>また、審査のポイントについても書かれていて、「自己資金をなるべく多く出す」「収入の安定性を証明できる資料が準備できるか」「健康かどうか」とまとめられていた。</p>

<p>ハウスメーカーにはこのうち、地銀とフラット35の仮審査の申し込みをお願いした。都銀はまず通らないだろうと思ったのと、信金系は金利が高いのでお勧めしにくい、と担当営業に言われたので。</p>

<hr>

<h2>仮審査の結果</h2>

<p>自分は審査の段階ではフリーになってから1年ちょいしか経っておらず、都銀や地銀は、確定申告の実績が2期分はないとまず通らない、とのことで、当然のことながら地銀の審査は落ちた。あと、自己資本比率が1割に満たないから、というのもありそう。</p>

<p>ただ、ファイナンシャルプランナーの方と話したところ、この確定申告の内容であれば、2期分あれば通りますよ、とも言われた。</p>

<p>フラット35も多分通らないだろうな、と思っていたし、通っても減額される可能性が高い、とファイナンシャルプランナーの方から言われていて、審査通らなかったら、スケジュールを後ろにずらして、また次の確定申告の後に改めて審査しよう、と思っていたら、希望額満額で通ってしまった。2期目の見込収入がわかる契約書や発注書のコピーも提出したので、それが良かったのかもしれない。</p>

<p>というわけで、フリーランスだと審査通りにくいと言われているし、実際地銀の審査は落ちたわけだけど、全然通らないというわけでもない、ということがわかった。</p>

<p>とは言え、やはり会社員の方が通りやすいことは確かであるし、上場企業だと金利が優遇されたりもするらしいので、世の中で言われているように、会社勤めしてる内にローンを組めるならその方が良い。</p>

<p>でも、フリーランスで実績が少ないからといって、まったく審査が通らない、ということはない、ということを身をもって経験できたので、世の中のフリーランスな人の参考になれば。</p>

<p>そういえば、以前のエントリで紹介した <a href="http://www.amazon.co.jp/dp/B00ET0L78Q">マンガ はじめて家を建てました！</a> のご夫婦も、旦那様がデザイナー、奥様が漫画家でどちらもフリーランスだけど、審査が通ったことがマンガで描かれていた。</p>

<p>住宅ローンの話になると、固定金利と変動金利、どちらが有利か、という話になるけれど、自分の場合は固定金利のフラット35しか審査が通らなかったので、どちらか悩む必要がなくて、却って良かったかな、とも思う。</p>

<p>また、現在のフラット35の金利は低い水準で推移してるし、一定の基準を満たせばフラット35Sが適用できて、10年間（または5年間）は金利が0.6%下がるし、毎月の返済額の見通しが長期にわたって立てやすいので、フラット35で十分満足している。</p>

<p>ファイナンシャルプランナーの方には、通常は固定金利と変動金利、それぞれの特徴について詳しく説明するんだけど、これだけ収入があれば、繰り上げ返済ガンガンできて、そういう人にとって多少の金利差はあまり関係ないので、固定でも変動でもどっちでもいいですよ、とは言われた。</p>

<p>そんな感じで、おそらくすぐには審査通らないだろうし、家づくりについてはゆっくり進めよう、と思っていたら、予想に反して通ってしまったので、フラット35を利用する、という前提で家づくりを進めることにした。</p>

<hr>

<h2>まとめ</h2>

<ul>
<li>早い段階で借入可能額を試算しておくと、その後の話が進めやすい。</li>
<li>試算は <a href="http://www.flat35.com/simulation/index.html">ローンシミュレーション：長期固定金利住宅ローン 【フラット３５】</a> などでできる。他にもググるとたくさん出てくる。</li>
<li>年収からの借入額試算と毎月の返済額からの借入額試算、の2パターンで試算。</li>
<li>自分は毎月の返済額から試算した借入額を上限として進めることにした。</li>
<li>都銀、地銀は、2期分の確定申告実績がないと住宅ローン審査はまず通らないらしい。</li>
<li>フラット35はフリーランス実績が1期だけでも審査が通った。</li>
<li>フラット35、低金利で推移してるし、優良住宅なら金利引き下げもあるし、返済額の見通しが長期にわたって立てやすいので、今（2015年12月）なら悪くない選択なのでは。</li>
</ul>

]]></content>
  </entry>

  <entry>
    <title type="html"><![CDATA[フリーランス2年目だけど家を建てることにした 其の3]]></title>
    <link href="http://mizzy.org/blog/2015/11/04/1/" />
    <updated>2015-11-04T23:00:03+09:00</updated>
    <id>http://mizzy.org/blog/2015/11/04/1/</id>
    <content type="html"><![CDATA[
<p>今回は業者選びについて。</p>

<hr>

<h2>スーモカウンターで業者を紹介してもらう</h2>

<p><a href="/blog/2015/07/05/1/">其の1</a>  で書いたように、住宅展示場の営業戦略にはまり、とあるハウスメーカーで話を聞くことになり、家を建てることにしたわけだけど、そのためには業者を選ばないといけない。でも、業者はものすごくたくさんある。<a href="http://www.suumocounter.jp/">スーモカウンター</a> でもらった資料を見ると、200〜300社（でも実際にはもっとありそう）。近所の住宅公園だけでも20社ぐらいあり、そこだけでも全部回るのは時間的に厳しい。そもそもどう選んだらいいのかすらもわからない。</p>

<p>というわけで、<a href="/blog/2015/08/25/1/">其の2</a>  で書いたように、まずはスーモカウンターに行ってみた。</p>

<p>ここで家づくりの基本について教えてもらい、こちらの要望を出して、それにあった業者を4社紹介してもらった。この時出した要望は以下の通り。</p>

<ul>
<li>木造がいい。</li>
<li>将来的に家族の人数が変わって、間取りを変えることを考えると木造軸組が望ましい。</li>
<li>なんとなく大手ハウスメーカーがいい。土地探しや資金の相談にも乗ってくれそう。</li>
<li>手間や時間をかけるより、お金で解決できるならそうしたい。</li>
<li>アレルギー持ちが多いので、ハウスダストとかシックハウスとか花粉とかものすごく気になる。</li>
</ul>

<p>こんな感じで要望を出して、紹介してもらったのが次の4社。</p>

<ul>
<li>国内シェアNo.1のハウスメーカー。ここは鉄骨系と木造系両方を手がけてる。シックハウス対策にかなり力を入れている。（A社）</li>
<li>木造軸組のトップハウスメーカー。自社で山林を保有してる。（B社）</li>
<li>日本でいち早くツーバイフォーを手がけたハウスメーカー。木造軸組じゃないけど、ハウスダストとかシックハウスとか花粉とか気になる、と言ったら、全館空調に強いハウスメーカーということで勧められた。（C社）</li>
<li>地元の工務店。要望の「大手ハウスメーカー」とは違うけど、木の風合いが良いので、木造が希望なら、こちらもどうですか、とスーモカウンタースタッフに勧められた。（D社）</li>
</ul>

<p>これらに追加して、</p>

<ul>
<li>最初に釣られて話を聞いた、純和風テイストが得意の木造軸組のハウスメーカー。（E社）</li>
<li>妻が見てみたいと希望した北米輸入住宅のハウスメーカー。（F社）</li>
<li>同じく妻が希望した北欧輸入住宅のハウスメーカー。（G社）</li>
</ul>

<p>の計7社にまずは絞り込んで、実際に各社に会って話を聞くことに。ちなみにこの段階だと、3〜8社ぐらいに絞るのが平均らしい。</p>

<hr>

<h2>各社との打ち合わせ</h2>

<p>最初に釣られたハウスメーカー以外は、すべてスーモカウンターを通じて日時の調整をしてもらった。で、実際に打ち合わせをしながら更に絞り込んでいく。</p>

<p>ここで大事なのは、事前に予算感を持っておくこと。資金計画についてもスーモカウンターで話を聞くことができて、「借入可能額」（年間所得を元に算出した借入上限額）と「借入希望額」（月々の希望返済額を元に算出した借入額）の計算をしてもらえるので、借入額＋頭金で、総額どれぐらいまで出せるのか、を把握しておくと良い。最初のうちは、土地や建物にどれぐらいお金が必要なのかがさっぱりわからない（そもそも、どれぐらいの広さの土地や建物が必要なのかすらわからない）けど、打ち合わせを進めるにつれ、総予算のうち、土地にこれぐらい、建物にこれぐらいかな、というのがなんとなく見えてくる。</p>

<p>また、ハウスメーカーや工務店によって坪単価が全然違うので、ここだと余裕がありそうだな、とかここだと建てるのは無理かな、みたいなのも早い段階でわかる（お金の話はまた別エントリで詳しく書く予定）。</p>

<p>各社との打ち合わせ後の感想は次のような感じ。</p>

<h3>A社</h3>

<p>シェアNo.1ってのを鼻にかけてる感じがちょっとした。うちを選んで当然でしょ、的な。シックハウス対策にかなり力を入れてることはわかったけど、それ以外はあまり印象に残らなかった。</p>

<h3>B社</h3>

<p>初回打ち合わせから、不動産屋の方も同席して、土地の話なども相談に乗ってもらえた。 </p>

<p>コンピューターシミュレーションで日照や風の通り道なんかを計算して設計に生かす、というのがウリのようで、おもしろそうだけど、春や秋の花粉の時期は外気はシャットアウトしたいので、通風とかは割とどうでもいいんだけどなー、と思った。</p>

<h3>C社</h3>

<p>モデルハウスの外観や間取りや内装がとてもよくて、こんな家に住みたいなー、と思わせてくれた。特に「スキップラウンジ」や「プチリュクス」と呼ばれる空間が気に入って、ぜひ取り入れたいと思った。</p>

<p>担当営業も紳士的で物腰やわらかで、押しつけがましくなくてよかった。</p>

<p>全館空調はスーモカウンターで話を聞くまではノーマークだったけど、話を聞いたらぜひ取り入れたいと思ったし、C社は全館空調を全面的に押していて、実績が豊富なのも良い。</p>

<p>複写で議事録をとって、打ち合わせ終了後にお互い押印して、原本を客側が、コピーをハウスメーカー側が保存、という形になってるのも良い。議事録があると、言った言わないの話になりにくいので。</p>

<h3>D社</h3>

<p>サービスとしてファイナンシャルプランナーを紹介してもらって、無料で相談ができた。それ以外はあまり印象に残ってない。</p>

<h3>E社</h3>

<p>担当営業が新卒2年目で頼りない。1番最初に話を聞いたハウスメーカーなので、最初は悪くないかな、と思ったけど、その後他のハウスメーカーを見たら、ここは全然魅力を感じなくなってしまった。柱の強度がものすごく強い、阪神淡路大震災の2倍の揺れでも大丈夫、ということをひたすら強調してたけど、そこまで強い必要ないし、それ以外に長所はないの、って思った。</p>

<p>担当営業が家まで手紙や手土産を届けに来たり、断った後も理由を聞きに来たりするのが非常に鬱陶しい。</p>

<p>議事録をしっかりとっているのは好印象。</p>

<h3>F社</h3>

<p>女性の方が好むタイプの外観や内装で、他の人の家であれば、素敵な家だなー、と思うんだろうけど、自分が住むとなると、いまいちピンと来なかった。</p>

<p>担当営業はとても印象がよかった。ほとんどのハウスメーカーは1回の打ち合わせで断ったけど、ここは何度か打ち合わせに行ったり、モデルハウスも何カ所か見に行ったりした。</p>

<h3>G社</h3>

<p>営業所長が出てきたけど、イヤな感じだった。説明とかは丁寧ではあるんだけど、なんとなく上から目線な臭いを感じてしまう。</p>

<p>北欧輸入住宅だけあって、断熱性能が高いのが良さそう。だけど、木製のベランダとか手入れがめんどくさそう、木枠の回転する窓は開けにくそうだし、これも手入れがめんどくさそう、と思った。実際はどうだか知らないけど。</p>

<hr>

<h2>打ち合わせを元に業者を絞り込む</h2>

<p>次のステップとしては、3〜5社に絞り込んで、更に打ち合わせを重ねて具体的なプランや見積の精度を上げて比較検討する、というのが標準的らしいんだけど、我が家はこの段階でいきなりC社のみに絞り込んだ。</p>

<p>早々と一社に絞り込んだのは、C社が他と比べて圧倒的に良かったので、これ以上他社との打ち合わせに時間をかけてもあまり意味がなさそうだな、と思ったので。</p>

<p>C社に絞っていたとしても、値引きを引き出すための材料として、他社とも話を進めて相見積をとる、というのが賢いやり方だろうけど、自分はそういうのが苦手だというのもある。相見積の精度を上げるために、複数社と何度も打ち合わせをするのは時間がかかって面倒だな、とも思った。</p>

<p>また、早々と御社に決めました、と言うと、担当営業のモチベーションも上がっていい仕事してくれるんじゃないかな、という狙いもあったり。実際、相見積をとって値下げ交渉したりとか、こちらから値引きを要求したりとかせずとも、かなり値下げしてくれた。担当営業も「他社がこれだけ値引きしてくれたから御社も値引きしてくれ、と言われるよりも、気持ちよく値引きできます」と言っていた。</p>

<p>そんな感じで、総合的に見て他社と比べて圧倒的に良かったのと、いいお客さんを演じることで、先方にも気持ちよく仕事してもらうため（それが結局は自分のためになるので）、C社に絞って更に詳細詰めていくことに。</p>

<p>我が家の業者選びはこんな感じで進んでいった。</p>

<hr>

<h2>業者選びの反省点</h2>

<p>今のところC社を選んだことはまったく後悔しておらず、いい業者を選んだな、と思っているんだけど、それはたまたま結果オーライだっただけで、今思うと、かなり情報収集不足だったな、と思う。たとえば業者の種別についてろくに知らなかった。</p>

<p>業者は大別すると以下の3つにわけられる（もちろん例外もあるけどここでは除外）。</p>

<ul>
<li>工務店</li>
<li>設計事務所</li>
<li>ハウスメーカー</li>
</ul>

<p>それぞれの特徴については、<a href="/blog/2015/08/25/1/">其の2</a> で紹介した <a href="http://www.amazon.co.jp/dp/B00ET0L78Q">マンガ はじめて家を建てました！</a> とか <a href="http://www.amazon.co.jp/dp/4140881224">家づくり必勝法</a> といった本や、<a href="http://chumon-jutaku.jp/knowledge/contractor/" title="注文住宅の依頼先 ／注文住宅のキホン | まるわかり注文住宅">注文住宅の依頼先 ／注文住宅のキホン | まるわかり注文住宅</a> なんかを見てもらえばいいので、ここでは説明しないけど、それぞれどういった人が向いてるか、というのを、「マンガ はじめて家を建てました！」から引用すると次のような感じになる。</p>

<ul>
<li>工務店

<ul>
<li>積極的に家づくりを楽しめる人</li>
<li>自分で内装や外装建材、水回りの商品を探すことを、楽しみに感じられる情熱のある人</li>
</ul></li>
<li>設計事務所

<ul>
<li>独創性のある家づくりをしたいと思ってる人</li>
<li>ゆっくりじっくり取り組める人</li>
<li>お金と時間に余裕を持てる人 </li>
</ul></li>
<li>ハウスメーカー

<ul>
<li>家づくりのための時間と手間ひまをあまりかけたくない人</li>
<li>資金面の相談から受け渡し後のメンテナンスまでいろんなサービスを受けたい人</li>
</ul></li>
</ul>

<p>この分類だと自分はまさにハウスメーカーが向いていて、最初の段階でハウスメーカーに絞ったのは間違いではなかったんだけど、上のような業者種別毎の特徴を抑えていたわけではなく、単になんとなくハウスメーカーがいいかな、と思っていただけだった。</p>

<p>結果的にそれがたまたま正しかったから良かったけど、自分に向いてない業者の中から選定しようとしていたら、なかなか業者が決まらない、とか、決まったけどなんかしっくりこないままずるずる進んでしまう、とか、最悪家づくりに失敗して、もう2度と家を建てようとは思わない、といった結果になったかもしれない。実際  <a href="http://www.amazon.co.jp/dp/4140881224">家づくり必勝法</a>  という本には、そういった事例も紹介されている。</p>

<p>なので、これから家を建てようと思っている人は、業者の種別と、自分がどの種別に向いてるのか、ということを把握するところから始めるのがよさそう。</p>

<p>また、業者選びにかける時間が短すぎたかな、とも思う。家建てるか、と思ったのが4月29日で、業者を一社に絞り込んだのが5月22日なので、業者選定に一ヶ月かかっていないことになる。</p>

<p>我が家の場合は、できる限り早急に今より広い家に移り住みたい、という事情があったから、しかたがない面もあるけど。</p>

<p>以前紹介した本や雑誌も、このわずかな期間に全部読んだわけではなく、業者を絞った後に読んだものもあるけれど、これは業者を絞る前に読むべきだった、と後から思ったものもある。</p>

<p>我が家は行かなかったけど、実際に各ハウスメーカーのお客さんが建てた家の見学会とか、建売前提のモデルハウスとか、建売物件での宿泊体験とかもあるので、そういったものにもできれば行った方が良さそう。住宅展示場のモデルハウスは営業用なので、面積も広いし、外装も内装も高いものを使っており、ハウスメーカー標準の坪単価よりも遙かにお金がかかっていて、まったく参考にならない、というわけではないけど、現実的ではないので。</p>

<hr>

<h2>まとめ</h2>

<ul>
<li>スーモカウンターで業者を紹介してもらった。</li>
<li>どれぐらいの金額を出せるのかを早い段階で把握しておくとよさそう。</li>
<li>最初は7社に絞って各社と打ち合わせした。</li>
<li>その後、3〜5社に絞るのが標準的らしいが、我が家の場合はいきなり1社に絞った。</li>
<li>工務店、設計事務所、ハウスメーカーといった業者種別の違いを理解して、自分がどの業者種別に向いているかを最初に把握しておくのがよさそう。</li>
<li>我が家は業者選定に時間かけなさすぎなので、真似しない方がいい。</li>
<li>住宅展示場のモデルハウスだけではなく、実際に建てられた家の見学会や、建売前提のモデルハウス、宿泊体験なんかもできれば行った方がよさそう。</li>
</ul>

]]></content>
  </entry>


</feed>
