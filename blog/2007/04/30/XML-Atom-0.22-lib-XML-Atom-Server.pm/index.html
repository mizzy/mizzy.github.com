
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>XML-Atom-0.22/lib/XML/Atom/Server.pm - Gosuke Miyashita</title>
  <meta name="author" content="Gosuke Miyashita">

  
  <meta name="description" content="source:XML-Atom-0.22/lib/XML/Atom/Server.pm NAME XML::Atom::Server - A server for the Atom API SYNOPSIS package My::Server; use base qw( XML::Atom:: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mizzy.org/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Server.pm">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Gosuke Miyashita" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53984-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Gosuke Miyashita</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mizzy.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">XML-Atom-0.22/lib/XML/Atom/Server.pm</h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-04-30T23:41:45+09:00" pubdate>Apr 30<span>th</span>, 2007</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>source:XML-Atom-0.22/lib/XML/Atom/Server.pm</p>

<h1>NAME</h1>

<p>XML::Atom::Server - A server for the Atom API</p>

<h1>SYNOPSIS</h1>

<pre><code>    package My::Server;
    use base qw( XML::Atom::Server );
    sub handle_request {
        my $server = shift;
        $server-&gt;authenticate or return;
        my $method = $server-&gt;request_method;
        if ($method eq 'POST') {
            return $server-&gt;new_post;
        }
        ...
    }

    my %Passwords;
    sub password_for_user {
        my $server = shift;
        my($username) = @_;
        $Passwords{$username};
    }

    sub new_post {
        my $server = shift;
        my $entry = $server-&gt;atom_body or return;
        ## $entry is an XML::Atom::Entry object.
        ## ... Save the new entry ...
    }

    package main;
    my $server = My::Server-&gt;new;
    $server-&gt;run;
</code></pre>

<h1>DESCRIPTION</h1>

<p><em>XML::Atom::Server</em> provides a base class for Atom API servers. It handles all core server processing, both the SOAP and REST formats of the protocol, and WSSE authentication. It can also run as either a mod_perl handler or as part of a CGI program.</p>

<p>It does not provide functions specific to any particular implementation, such as posting an entry, retrieving a list of entries, deleting an entry, etc. Implementations should subclass <em>XML::Atom::Server&#8221;, overriding the &#8221;handle_request</em> method, and handle all functions such as this themselves.</p>

<h1>SUBCLASSING</h1>

<h2>Request Handling</h2>

<p>Subclasses of <em>XML::Atom::Server&#8221; must override the &#8221;handle_request</em> method to perform all request processing. The implementation must set all response headers, including the response code and any relevant HTTP headers, and should return a scalar representing the response body to be sent back to the client.</p>

<p>For example:</p>

<pre><code>    sub handle_request {
        my $server = shift;
        my $method = $server-&gt;request_method;
        if ($method eq 'POST') {
            return $server-&gt;new_post;
        }
        ## ... handle GET, PUT, etc
    }

    sub new_post {
        my $server = shift;
        my $entry = $server-&gt;atom_body or return;
        my $id = save_this_entry($entry);  ## Implementation-specific
        $server-&gt;response_header(Location =&gt; $server-&gt;uri . '/entry_id=' . $id);
        $server-&gt;response_code(201);
        $server-&gt;response_content_type('application/x.atom+xml');
        return serialize_entry($entry);    ## Implementation-specific
    }
</code></pre>

<h2>Authentication</h2>

<p>Servers that require authentication for posting or retrieving entries or feeds should override the <em>password_for_user&#8221; method. Given a username (from the WSSE header), &#8221;password_for_user</em> should return that user&#8217;s password in plaintext. This will then be combined with the nonce and the creation time to generate the digest, which will be compared with the digest sent in the WSSE header. If the supplied username doesn&#8217;t exist in your user database or alike, just return <code>undef</code>.</p>

<p>For example:</p>

<pre><code>    my %Passwords &gt; 'bar' );   ## The password for "foo" is "bar".
    sub password_for_user {
        my $server = shift;
        my($username) = @_;
        $Passwords{$username};
    }
</code></pre>

<h1>METHODS</h1>

<p><em>XML::Atom::Server</em> provides a variety of methods to be used by subclasses for retrieving headers, content, and other request information, and for setting the same on the response.</p>

<h2>Client Request Parameters</h2>

<ul>
<li>$server->uri</li>
</ul>


<p> Returns the URI of the Atom server implementation.</p>

<ul>
<li>$server->request_method</li>
</ul>


<p> Returns the name of the request method sent to the server from the client (for example, <code>GET</code>, <code>POST</code>, etc). Note that if the client sent the request in a SOAP envelope, the method is obtained from the <em>SOAPAction</em> HTTP header.</p>

<ul>
<li>$server->request_header($header)</li>
</ul>


<p> Retrieves the value of the HTTP request header <em>$header</em>.</p>

<ul>
<li>$server->request_content</li>
</ul>


<p> Returns a scalar containing the contents of a POST or PUT request from the client.</p>

<ul>
<li>$server->request_param($param)</li>
</ul>


<p> <em>XML::Atom::Server</em> automatically parses the PATH_INFO sent in the request and breaks it up into key-value pairs. This can be used to pass parameters. For example, in the URI</p>

<pre><code>    http://localhost/atom-server/entry_id=1
</code></pre>

<p> the <em>entry_id</em> parameter would be set to <code>1</code>.</p>

<p> <em>request_param&#8221; returns the value of the value of the parameter &#8221;$param</em>.</p>

<h2>Setting up the Response</h2>

<ul>
<li>$server->response_header($header, $value)</li>
</ul>


<p> Sets the value of the HTTP response header <em>$header&#8221; to &#8221;$value</em>.</p>

<ul>
<li>$server->response_code([ $code ])</li>
</ul>


<p> Returns the current response code to be sent back to the client, and if <em>$code</em> is given, sets the response code.</p>

<ul>
<li>$server->response_content_type([ $type ])</li>
</ul>


<p> Returns the current <em>Content-Type&#8221; header to be sent back to the client, and &#8221;$type</em> is given, sets the value for that header.</p>

<h2>Processing the Request</h2>

<ul>
<li>$server->authenticate</li>
</ul>


<p> Attempts to authenticate the request based on the authentication information present in the request (currently just WSSE). This will call the <em>password_for_user</em> method in the subclass to obtain the cleartext password for the username given in the request.</p>

<ul>
<li>$server->atom_body</li>
</ul>


<p> Returns an <em>XML::Atom::Entry</em> object containing the entry sent in the request.</p>

<h1>USAGE</h1>

<p>Once you have defined your server subclass, you can set it up either as a CGI program or as a mod_perl handler.</p>

<p>A simple CGI program would look something like this:</p>

<pre><code>    #!/usr/bin/perl -w
    use strict;

    use My::Server;
    my $server = My::Server-&gt;new;
    $server-&gt;run;
</code></pre>

<p>A simple mod_perl handler configuration would look something like this:</p>

<pre><code>    PerlModule My::Server
    &lt;Location /atom-server&gt;
        SetHandler perl-script
        PerlHandler My::Server
    &lt;/Location&gt;
</code></pre>

<h1>ERROR HANDLING</h1>

<p>If you wish to return an error from <em>handle_request&#8221;, you can use the built-in &#8221;error</em> method:</p>

<pre><code>    sub handle_request {
        my $server = shift;
        ...
        return $server-&gt;error(500, "Something went wrong");
    }
</code></pre>

<p>This will be returned to the client with a response code of 500 and an error string of <code>Something went wrong</code>. Errors are automatically serialized into SOAP faults if the incoming request is enclosed in a SOAP envelope.</p>

<h1>AUTHOR &amp; COPYRIGHT</h1>

<p>Please see the <em>XML::Atom</em> manpage for author, copyright, and license information.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Gosuke Miyashita</span></span>

      




  

<time datetime="2007-04-30T23:41:45+09:00" pubdate>Apr 30<span>th</span>, 2007</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://mizzy.org/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Server.pm/" data-via="" data-counturl="http://mizzy.org/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Server.pm/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Person.pm/" title="Previous Post: XML-Atom-0.22/lib/XML/Atom/Person.pm">&laquo; XML-Atom-0.22/lib/XML/Atom/Person.pm</a>
      
      
        <a class="basic-alignment right" href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Util.pm/" title="next Post: XML-Atom-0.22/lib/XML/Atom/Util.pm">XML-Atom-0.22/lib/XML/Atom/Util.pm &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/01/06/weechat-script-for-pushing-notification-to-im-dot-kayac-dot-com/">WeeChat script for pushing notification to im.kayac.com</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/20/lunar-eclipse/">Lunar Eclipse</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/20/a-picture-of-geminids/">A Picture of Geminids</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/13/maglica-presentation-at-hatena/">Maglica Presentation At Hatena</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/15/octopress-on-heteml/">How to deploy a blog made by Octopress to Heteml</a>
      </li>
    
  </ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Gosuke Miyashita -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mizzyorg';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
