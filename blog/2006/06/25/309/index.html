
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PPerl と plagger - Gosuke Miyashita</title>
  <meta name="author" content="Gosuke Miyashita">

  
  <meta name="description" content="Perl Hacks に載ってた Hack #81 の PPerl を plagger で試してみよう、と思ったら 既に試していらっしゃる方 がおりました。 というわけで、PPerl が何なのかは id:odz さん の上記エントリを見てください。 と、これだけでも何なので、PPerl &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mizzy.org/blog/2006/06/25/309">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Gosuke Miyashita" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53984-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Gosuke Miyashita</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mizzy.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">P Perl と Plagger</h1>
    
    
      <p class="meta">
        




  

<time datetime="2006-06-25T18:19:00+09:00" pubdate>Jun 25<span>th</span>, 2006</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>
<a class="ext-link" href="http://www.amazon.co.jp/exec/obidos/ASIN/0596526741/httshemizorg-22/ref=nosim"><span class="icon"></span>Perl Hacks</a> に載ってた Hack <a class="ticket" href="/ticket/81">#81</a> の <a class="ext-link" href="http://search.cpan.org/dist/PPerl/"><span class="icon"></span>PPerl</a> を plagger で試してみよう、と思ったら <a class="ext-link" href="http://d.hatena.ne.jp/odz/20060524/1148529647"><span class="icon"></span>既に試していらっしゃる方</a> がおりました。
</p>


<p>
というわけで、PPerl が何なのかは <a class="ext-link" href="http://d.hatena.ne.jp/odz/"><span class="icon"></span>id:odz さん</a> の上記エントリを見てください。
</p>


<p>
と、これだけでも何なので、PPerl について気になって調べたことをメモ。まず、global セクションだけ書いた config.yaml で plagger を起動して、ps コマンドで仮想メモリ容量を見てみると、こんな感じになってます。
</p>


<pre class="wiki">
$ pperl plagger                                           [~/plagger]
Plagger [info] plugin Plagger::Plugin::Aggregator::Simple loaded.
$ ps -eo pid,ppid,vsz,args|grep plagger|grep -v grep           [~/plagger]
 6470     1 10772 plagger
 6471  6470 <strong>18592</strong> plagger
 6472  6470 10772 plagger
 6473  6470 10772 plagger
 6474  6470 10772 plagger
 6475  6470 10772 plagger
</pre>


<p>
さらにもう2回ほど pperl plagger を実行すると、
</p>


<pre class="wiki">
$ pperl plagger                                           [~/plagger]
Plagger [info] plugin Plagger::Plugin::Aggregator::Simple loaded.
$ pperl plagger                                           [~/plagger]
Plagger [info] plugin Plagger::Plugin::Aggregator::Simple loaded.
$ ps -eo pid,ppid,vsz,args|grep plagger|grep -v grep           [~/plagger]
 6470     1 10772 plagger
 6471  6470 <strong>18592</strong> plagger
 6472  6470 <strong>18582</strong> plagger
 6473  6470 <strong>18582</strong> plagger
 6474  6470 10772 plagger
 6475  6470 10772 plagger
</pre>


<p>
さらにもう何回か実行してみる。
</p>


<pre class="wiki">
$ ps -eo pid,ppid,vsz,args|grep plagger|grep -v grep      [~/plagger]
 6470     1 10772 plagger
 6471  6470 <strong>18592</strong> plagger
 6472  6470 <strong>18592</strong> plagger
 6473  6470 <strong>18592</strong> plagger
 6474  6470 <strong>18592</strong> plagger
 6475  6470 <strong>18592</strong> plagger
</pre>


<p>
こんな感じで、プロセス ID 6470 が大元の親プロセスになって、他の plagger プロセスをフォークしていて、 親プロセスの仮想メモリ容量が 10772KB、他の子プロセスの仮想メモリ容量との差分である 7820KB が plagger 関連モジュールが確保している仮想メモリ容量なんだろうなぁ、ということが分かります。
</p>


<p>
で、今度は普段使っているコンフィグで起動してみます。
</p>


<pre class="wiki">
$ pperl plagger --config=gmail.yaml
Plagger [info] plugin Plagger::Plugin::Subscription::Bloglines loaded.
Plagger [info] plugin Plagger::Plugin::Subscription::Config loaded.
Plagger [info] plugin Plagger::Plugin::CustomFeed::Simple loaded.
Plagger [info] plugin Plagger::Plugin::CustomFeed::YajiumaWatch loaded.
Plagger [info] plugin Plagger::Plugin::CustomFeed::KotonohaInbox loaded.
Plagger [info] plugin Plagger::Plugin::Filter::EntryFullText loaded.
Plagger [info] plugin Plagger::Plugin::Filter::TruePermalink loaded.
Plagger [info] plugin Plagger::Plugin::Filter::StripRSSAd loaded.
Plagger [info] plugin Plagger::Plugin::Filter::BloglinesContentNormalize loaded.
Plagger [info] plugin Plagger::Plugin::Filter::HatenaDiaryKeywordUnlink loaded.
Plagger [info] plugin Plagger::Plugin::Filter::Rule loaded.
Plagger [info] plugin Plagger::Plugin::Widget::Delicious loaded.
Plagger [info] plugin Plagger::Plugin::Widget::BloglinesSubscription loaded.
Plagger [info] plugin Plagger::Plugin::Publish::Gmail loaded.
... snip ...
$ ps -eo pid,ppid,vsz,args|grep plagger|grep -v grep      [~/plagger]
 6470     1 10772 plagger
 6471  6470 18592 plagger
 6472  6470 18592 plagger
 6473  6470 18592 plagger
 6474  6470 18592 plagger
 6475  6470 <strong>37388</strong> plagger
</pre>


<p>
と、こんな感じで、ID 6475 のプロセスが大きくなってます。これがこのコンフィグで増えた Plagger Plugin モジュールのメモリ容量みたいですね。
</p>


<p>
といったように、pperl を最初に起動した時のモジュールだけをメモリ上に確保するだけではなく、その後新たに読み込まれたモジュールもちゃんとメモリ上に確保してくれているようです。当たり前っちゃ当たり前の気もしますが、何となく気になったので。 
</p>


<p>
他に気になった点として、起動するプロセスの数を増やしたり、制限したりできるのかな、と思ったところ、以下の様なオプションがあるので、この辺りも制御できるようですね。
</p>


<pre class="wiki">
$ pperl --help                                            [~/plagger]
pperl version 0.25
Usage: pperl [options] filename
perl options are passed to your perl executable (see the perlrun man page).
pperl options control the persistent perl behaviour

PPerl Options:
  -k  or --kill      Kill the currently running pperl for that script
  -h  or --help      This page
  --prefork          The number of child processes to prefork (default=5)
  --maxclients       The number of client connections each child
                       will process (default=100)
  -z  or --anyuser   Allow any user (after the first) to access the socket
                       WARNING: This has severe security implications. Use
                       at your own risk
  --no-cleanup       Skip the cleanup stage at the end of running your script
                       this may make your code run faster, but if you forget
                       to close files then they will remain unflushed and unclosed
</pre>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Gosuke Miyashita</span></span>

      




  

<time datetime="2006-06-25T18:19:00+09:00" pubdate>Jun 25<span>th</span>, 2006</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://mizzy.org/blog/2006/06/25/309/" data-via="" data-counturl="http://mizzy.org/blog/2006/06/25/309/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2006/06/20/352/" title="Previous Post: Text::Trac - Trac Wiki 記法パーサ #2">&laquo; Text::Trac - Trac Wiki 記法パーサ #2</a>
      
      
        <a class="basic-alignment right" href="/blog/2006/07/02/316/" title="next Post: Atom Threading Extensions">Atom Threading Extensions &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/03/31/puppet-report-ikachan/">puppet-report-ikachan</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/07/image-with-exif-tag-plugin/">Image with EXIF tag plugin</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/07/exif-tag-plugin/">EXIF tag plugin</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/04/rakuten-tag-plugin/">Rakuten tag plugin for Jekyll</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/29/paperboys-engineer-evaluation-system/">Paperboy's engineer evaluation system</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Coderwall</h1>
  <p>
  <script type="text/javascript">
    function display_coderwall(args) {
        var badges = args["data"]["badges"];
        for ( var i = 0; i < badges.length; i++ ) {
            document.write('<img src="'+ badges[i]["badge"] + '" width="48" height="48" />');
        }
    }
  </script>
  <script src="http://coderwall.com/mizzy.json?callback=display_coderwall"></script>
  </p>
  <p style="text-align: right;"><a href="http://coderwall.com/mizzy">Powered by coderwall.com</a></p>
</section>


<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mizzy">@mizzy</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mizzy',
            count: 30,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Gosuke Miyashita -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mizzyorg';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://mizzy.org/blog/2006/06/25/309';
        var disqus_url = 'http://mizzy.org/blog/2006/06/25/309';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
