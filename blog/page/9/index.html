
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Gosuke Miyashita</title>
  <meta name="author" content="Gosuke Miyashita">

  
  <meta name="description" content="関西オープンソース 2008 で、30days Album の 裏側についてお話します。 30days Album で利用している OSS を思いつくままざっとあげてみると、Linux, Perl, Perlbal, lighttpd, MogileFS, Gearman, TheSchwartz &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mizzy.org/blog/page/9">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Gosuke Miyashita" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53984-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Gosuke Miyashita</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mizzy.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/10/29/KansaiOpenSource2008/">KansaiOpenSource2008</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-10-29T00:51:41+09:00" pubdate>Oct 29<span>th</span>, 2008</time>
        
         | <a href="/blog/2008/10/29/KansaiOpenSource2008/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://k-of.jp/2008/list.html">関西オープンソース 2008</a> で、<a href="http://30d.jp/">30days Album</a> の <a href="http://k-of.jp/2008/list_seminar.html#70">裏側についてお話します</a>。</p>

<p><a href="http://30d.jp/">30days Album</a> で利用している OSS を思いつくままざっとあげてみると、Linux, Perl, Perlbal, lighttpd, MogileFS, Gearman, TheSchwartz, Catalyst, Ruby, Ruby On Rails, BackgrounDrb, MySQL, memcached, LVM, Subversion, Archer, Puppet, OpenLDAP, OpenSSH + lpk patch, Nagios, HotSanic といった感じになるわけですが、これらの OSS をどんな風に使ってるのか、という話を、サービスとしての観点と、運用まわりの観点からお話したいと思います。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/09/14/HowToBuildAScalableStorageSystemWithOSS/">HowToBuildAScalableStorageSystemWithOSS</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-09-14T13:48:34+09:00" pubdate>Sep 14<span>th</span>, 2008</time>
        
         | <a href="/blog/2008/09/14/HowToBuildAScalableStorageSystemWithOSS/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.tlug.jp/wiki/Meetings:2008:09">TLUG Meeting 2008/09</a> で話した、<a href="http://www.slideshare.net/mizzy/how-to-build-a-scalable-storage-system-at-tlug-meeting-20080913-presentation">How to build a scalable storage system with OSS のスライドを slideshare にアップ</a> しました。</p>

<p>英語で初のプレゼンってことで、途中言葉が出てこないことがあったり、英語で質問された内容がうまく聞き取れなかったり、元々開始が遅くて押し気味のスケジュールのところ、時間感覚が全然なくてオーバーしてしまい、最後の Edward さんの発表時間がなくなってしまったりと、反省点だらけ。</p>

<p>プレゼンの内容自体は、自分は今こんなこと検討していて、こういう技術について調べてみたんだけど、他にもいいやりかたとか、いい技術とかあれば教えてください、といったスタンスだったんですが、息子の容態がおかしい、と妻から連絡が入って、飲み会開始早々帰ることになったため、他の方の意見を聞く時間がなく、目的を果たせませんでした。（プレゼン後、飲み会の移動までの間に、二人の方と軽くお話できましたが。）あ、ちなみに息子は、今日は元気にもりもり飯食ってます。</p>

<p>内容的にも、いろんなコンポーネントが協調して動くストレージシステムの話なので、短時間でプレゼンして議論するには、かなりきつかったですね。このネタだけでひとつカンファレンスが成り立つんじゃないかと思います。（と、StorageCon 開催フラグを立ててみる。）</p>

<p>というわけで、初の英語プレゼンチャレンジは、成功したとは言い難いのですが、いい経験になりましたし、興味深い話が聞けて良かったと言ってくださった方もいたり、それにやっぱり、人前で技術プレゼンするのは楽しいなー、と改めて思ったりで、また機会があればぜひやらせてもらいたいです。</p>

<p>この機会をくださった<a href="http://trombik.mine.nu/~cherry/w/">桜井さん</a>に大変感謝しています。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/09/12/TlugMeeting200809/">TlugMeeting200809</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-09-12T16:48:42+09:00" pubdate>Sep 12<span>th</span>, 2008</time>
        
         | <a href="/blog/2008/09/12/TlugMeeting200809/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.tlug.jp/wiki/Meetings:2008:09">TLUG Meeting 2008/09</a> で、高価なハードウェアを使わずに OSS のみで、スケーラブルなストレージをどうやって構成するのか、といった話をします。人生初の英語でのプレゼンにチャレンジ。</p>

<p>最初は<a href="http://trombik.mine.nu/~cherry/w/">桜井さん</a>から、「ModSecurity の話をするのですが、興味ないですか？」とお誘い頂いて、「興味あります！」と聞きに行くことにしたんですが、いつの間にか自分もしゃべることになってしまいました。</p>

<p>ストレージについては、実際に構築した、という話ではなく、最近この辺りについて調べていて、こんな風にやればできそうだなー、という情報がある程度まとまってきて、ちょうど良い機会を頂いたので話してみようかな、という感じです。</p>

<p>発表の中では、cman, CLVM, GNBD, GFS2, DRBD, DM-MP といった技術について説明し、これらをどう組み合わせて、スケーラブルなストレージを構成するのか、といった話をする予定です。</p>

<p>発表資料は後ほどアップしますし、詳細な技術情報はおいおいここのブログでも書いていこうと思っています。</p>

<p>TLUG Meeting は事前申し込みが不要で、直接現地に行けば良いようですので、お時間があって興味のあるかたはぜひ。（エンジニアの未来サミットとかぶってますが…）</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/06/05/Inside30daysAlbumsBackEnd/">Inside30daysAlbumsBackEnd</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-06-05T10:52:38+09:00" pubdate>Jun 5<span>th</span>, 2008</time>
        
         | <a href="/blog/2008/06/05/Inside30daysAlbumsBackEnd/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://30d.jp/">30days Album</a> の <a href="http://30d.jugem.jp/">インフォメーションブログ</a> に、<a href="http://30d.jugem.jp/?eid=13">30days Album を支える技術 #0 ～ サーバ構成概要</a> というエントリをポストしました。</p>

<p>今回は全体的なサーバ構成の概要について書いています。今後、各コンポーネント毎に、実際に担当した技術スタッフとともに、詳細掘り下げて解説していく予定です。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/16/YapcAsia2008TokyoPunc/">YapcAsia2008TokyoPunc</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-05-16T10:46:16+09:00" pubdate>May 16<span>th</span>, 2008</time>
        
         | <a href="/blog/2008/05/16/YapcAsia2008TokyoPunc/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>昨日のYAPC::Asia 2008 Tokyo 初日のセッションで発表した、「Easy system administration programming with a framework - フレームワークでシステム管理プログラミングをもっと簡単に」の資料を <a href="http://www.slideshare.net/mizzy/yapcasia-2008-tokyo-easy-system-administration-programming-with-a-framework-by-gosuke-miyashita">Slide Share にアップ</a>しました。</p>

<p>今日はどうしても外せないミーティングのため、午後から YAPC 会場に向かいます。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/05/06/MooseXClassAttribute/">MooseXClassAttribute</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-05-06T13:05:43+09:00" pubdate>May 6<span>th</span>, 2008</time>
        
         | <a href="/blog/2008/05/06/MooseXClassAttribute/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>流行に乗って <a href="http://coderepos.org/share/wiki/Punc">Punc</a> にも Moose を取り入れようと思って、MooseX::ClassAttribute でクラス属性をハンドリングできるようにしてみたのですが、子クラスのクラス属性をセットすると、親クラスのクラス属性まで変わってしまう。</p>

<pre><code>#!perl
#!/usr/bin/perl

package Parent;
use Moose;
use MooseX::ClassAttribute;

class_has 'x' =&gt; ( is =&gt; 'rw' );

package Child;
use Moose;
extends 'Parent';

package main;

Parent-&gt;x('Parent');
warn Parent-&gt;x; # Parent が表示される

Child-&gt;x('Child');
warn Parent-&gt;x; # Child が表示されてしまう
</code></pre>

<p>これが一般的に望ましい動作なのかどうかわからないので、とりあえず Class::Data::Inheritable 使うように書き直した。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/03/30/KlabAndFuncAndPunc/">KlabAndFuncAndPunc</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-03-30T21:28:20+09:00" pubdate>Mar 30<span>th</span>, 2008</time>
        
         | <a href="/blog/2008/03/30/KlabAndFuncAndPunc/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://dsas.blog.klab.org/archives/51199866.html">KLab 勉強会 #4</a> で、<a href="https://fedorahosted.org/func/">Func</a> についてしゃべってきました。その時の様子は <a href="http://www.ustream.tv/channel/KLab">Ustream</a> でご覧いただけます。また資料は後日 <a href="http://dsas.blog.klab.org">DSAS 開発者の部屋</a>にアップされると思います。</p>

<p>スピーカのために壇上に水が用意されていることはよくあると思いますが、今回は僕のためにドクターペッパーが用意されているというスペシャルな待遇に感激しました。</p>

<p>で、Func についてしゃべった中で、いくつかいけてない点をあげたのですが、特に RedHat 系 Linux にしか対応してない、というところに不満もあり、また、モジュールを Perl で書きたいという思いもあり、じゃあ Perl で実装しちゃえ、ってことで、<a href="http://coderepos.org/share/wiki/Punc">Punc - Perl Unified Network Controller</a> なるものをつくりはじめました。</p>

<p>今のところプロトタイプでしかないため、まだまだ完成には程遠いですが、RedHat 系 Linux 上でサービスの起動状態を確認する、ということができるまでにはなっています。他の OS 用のモジュールを追加すれば、自動で判別して適切なモジュールを選択してくれる機能も実装しています。</p>

<p>YAPC::Asia 2008 でお話しする予定の <a href="http://conferences.yapcasia.org/ya2008/talk/973">システム管理フレームワークのアーキテクチャと Perl による実装</a> では、この Punc について詳しく解説する予定です。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/03/09/library-perl-trunk-FormValidator-Simple-Plugin-Number-Phone-JP-lib-FormValidator-Simple-Plugin-Number-Phone-JP.pm/">library/perl/trunk/FormValidator-Simple-Plugin-Number-Phone-JP/lib/FormValidator/Simple/Plugin/Number/Phone/JP.pm</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-03-09T12:51:35+09:00" pubdate>Mar 9<span>th</span>, 2008</time>
        
         | <a href="/blog/2008/03/09/library-perl-trunk-FormValidator-Simple-Plugin-Number-Phone-JP-lib-FormValidator-Simple-Plugin-Number-Phone-JP.pm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>source:library/perl/trunk/FormValidator-Simple-Plugin-Number-Phone-JP/lib/FormValidator/Simple/Plugin/Number/Phone/JP.pm</p>

<h1>NAME</h1>

<p>FormValidator::Simple::Plugin::Number::Phone::JP - Japanese phone number validation</p>

<h1>SYNOPSIS</h1>

<pre><code>  use FormValidator::Simple qw/Number::Phone::JP/;

  my $result &gt; [
      tel       =&gt; [ 'NOT_BLANK', 'NUMBER_PHONE_JP' ],
  ] );
</code></pre>

<h1>DESCRIPTION</h1>

<p>This modules adds Japanese phone number validation command to FormValidator::Simple.</p>

<h1>SEE ALSO</h1>

<p>FormValidator::Simple</p>

<p>Number::Phone::JP</p>

<h1>AUTHOR</h1>

<p>Gosuke Miyashita, <a href="&#x6d;&#x61;&#x69;&#108;&#116;&#111;&#58;&#103;&#x6f;&#x73;&#x75;&#x6b;&#x65;&#x6e;&#x61;&#116;&#111;&#114;&#x40;&#103;&#x6d;&#x61;&#x69;&#108;&#46;&#99;&#111;&#109;">&#x67;&#111;&#x73;&#117;&#107;&#x65;&#110;&#97;&#x74;&#x6f;&#114;&#64;&#103;&#109;&#x61;&#x69;&#x6c;&#46;&#x63;&#x6f;&#x6d;</a></p>

<h1>COPYRIGHT AND LICENSE</h1>

<p>Copyright (C) 2005 by Gosuke Miyashita</p>

<p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself, either Perl version 5.8.5 or, at your option, any later version of Perl 5 you may have available.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/03/04/oVirt00/">oVirt00</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-03-04T01:20:28+09:00" pubdate>Mar 4<span>th</span>, 2008</time>
        
         | <a href="/blog/2008/03/04/oVirt00/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Puppet Dojo で知り合った方から、<a href="http://virt-factory.et.redhat.com/">Virt-Factory</a> はもうアクティブじゃなくなって、今は<a href="http://ovirt.org/">oVirt</a> という新しいプロジェクトに移ってる、ということをお聞きして、Virt-Factory のサイトに行ってみたら本当にそう書いてある！Xen が動かせるマシンが調達できたら、本格的に Virt-Factory 検証しよう、と思ってしばらくアクセスしてなかったら、いつの間にやらこんなことに…</p>

<p>つーわけで、Virt-Factory は捨てて oVirt の検証していくです。</p>

<p><a href="http://ovirt.org/install-instructions.html">Installing Instructions</a> を見てみると、パッケージを配布してるわけじゃなく、QEMU/KVM の仮想マシンイメージとして配布されてる模様。まずはこのイメージを動かすところまでやってみる。</p>

<p>検証環境は CentOS 5 x86_64 です。手順は上記サイトの「Installing the management appliance」の通りではあるのですが、説明があまり親切ではないし、その通りではうまくいかないところもあったので、試してみたい方は、以下の手順も合わせて参考にしてみてください。。</p>

<p>まずは VM イメージを取得。場所はどこでもいいんですが、自分は ~/vm というディレクトリを作成して、その下に置いた。</p>

<pre><code>$ mkdir ~/vm
$ cd ~/vm
$ wget http://ovirt.org/download/wui-appliance.dsk.bz2
$ bzip2 -d wui-appliance.dsk.bz2
</code></pre>

<p>次に必要なパッケージのインストール。</p>

<pre><code>$ sudo yum install libvirt qemu kvm
</code></pre>

<p>以下のような ~/vm/wui-appliance.xml を作成。</p>

<pre><code>&lt;domain type="kvm"&gt;
  &lt;name&gt;wui-appliance&lt;/name&gt;
  &lt;memory&gt;768000&lt;/memory&gt;
  &lt;currentMemory&gt;768000&lt;/currentMemory&gt;
  &lt;vcpu&gt;1&lt;/vcpu&gt;
  &lt;os&gt;
    &lt;type&gt;hvm&lt;/type&gt;
    &lt;boot dev="hd"/&gt;
  &lt;/os&gt;
  &lt;clock offset="utc"/&gt;
  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
  &lt;on_crash&gt;destroy&lt;/on_crash&gt;
  &lt;devices&gt;
    &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt;
    &lt;disk type="file"&gt;
      &lt;source file="/home/miya/vm/wui-appliance.dsk"/&gt;
      &lt;target dev="hda"/&gt;
    &lt;/disk&gt;
    &lt;interface type="bridge"&gt;
      &lt;mac address="00:16:3e:08:97:e7"/&gt;
      &lt;source bridge="xenbr0"/&gt;
    &lt;/interface&gt;
    &lt;input type="mouse" bus="ps2"/&gt;
    &lt;graphics type="vnc" port="-1" listen="0.0.0.0"/&gt;
  &lt;/devices&gt;
&lt;/domain&gt;
</code></pre>

<p>libvirtd を起動して、virsh で qemu に接続、create でさきほどの XML ファイルを指定して VM 作成。</p>

<pre><code>$ sudo /sbin/chkconfig libvirtd on
$ sudo /etc/init.d/libvirtd start
$ sudo virsh --connect qemu:///system  
virsh #  create wui-appliance.xml
Domain wui-appliance created from wui-appliance.xml
virsh # list
 Id Name                 State
----------------------------------
  1 wui-appliance        running
</code></pre>

<p>以上で VM 起動まで完了。で、VM に SSH とかでアクセスしたいんだけど、IP アドレスがわからない！（VM の IP アドレスを外から知る方法をご存知な方は教えてください。）というわけで、virt-manager からつないでみることにする。</p>

<pre><code>$ sudo yum install virt-manager
</code></pre>

<p>virt-manager 入れたのはいいけど、CentOS は X 使えるようにしていないことに気づく。とりあえず手元の PC の cygwin に X が入ってたので、cygwin のシェルで</p>

<pre><code>$ startxwin.sh
$ xhost +
</code></pre>

<p>でもって CentOS 上で</p>

<pre><code>$ export DISPLAY=192.168.10.19:0.0
$ virt-manager
</code></pre>

<p>で virt-manager 起動。</p>

<p>[[Image(01.jpg)]]</p>

<p>無事に画面が出たので、QEMU を選択して接続。</p>

<p>[[Image(02.jpg)]]</p>

<p>VM が見えるので選択して、右下の「Open」をクリック。</p>

<p>[[Image(03.jpg)]]</p>

<p>無事アクセスできた。root のパスワードは ovirtwui 。</p>

<p>ここまでやってから、XML で MAC アドレス指定してるんだから、DHCP サーバのログから IP アドレス調べればいいだけだった、ということに気づく。</p>

<p>今日はここまで。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/02/03/YCombinatorWithPerl/">YCombinatorWithPerl</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2008-02-03T03:03:52+09:00" pubdate>Feb 3<span>rd</span>, 2008</time>
        
         | <a href="/blog/2008/02/03/YCombinatorWithPerl/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>計算機科学を学んでいる人にとっては今更な話題らしいですが、経済学部出身の自分には目新しい話題なので書いてみます。（といっても、全然知らなかった、というわけでもないんですが。）</p>

<p><a href="http://d.hatena.ne.jp/amachang/20080124/1201199469">id:amachang</a> さんのエントリにある最終形のみを Perl で書くとこんな感じかな。</p>

<pre><code>#!perl
my $Y = sub {
    my $f = shift;
    return sub {
        my $g = shift;
        return sub {
            my $m = shift;
            return $f-&gt;($g-&gt;($g))-&gt;($m);
        }
    }-&gt;(
        sub {
            my $g = shift;
            return sub {
                my $m = shift;
                return $f-&gt;($g-&gt;($g))-&gt;($m);
            };
        }
    )
};

my $fib = sub {
    my $f = shift;
    return sub {
        my $n = shift;
        return $n &lt;= 2 ? 1 : $f-&gt;($n - 1) + $f-&gt;($n - 2);
    };
};

warn $Y-&gt;($fib)-&gt;(10);
</code></pre>

<hr />

<p>なぜこれで再帰として動作するかを考えるにあたって、<a href="http://d.hatena.ne.jp/gotin/20080127/1201372491">id:gotin</a> さんのエントリと同内容のことを、Perl で考えてみる。</p>

<p>簡単にするために最終形の Y コンビネータになる前の中間形のコードで考える。</p>

<pre><code>#!perl
my $Y = sub {
    my $f = shift;
    my $g;
    return $g = sub {
        my $n = shift;
        $f-&gt;($g)-&gt;($n);
    }
};

my $fib = sub {
    my $f = shift;
    return sub {
        my $n = shift;
        return $n &lt;= 2 ? 1 : $f-&gt;($n - 1) + $f-&gt;($n - 2);
    }
};

warn $Y-&gt;($fib)-&gt;(5);
</code></pre>

<p>$Y->($fib) は、 my $Y = sub { &#8230; } において、$f に $fib が代入され、結果として以下の関数が返ることになる。</p>

<pre><code>#!perl
sub {
    my $n = shift;
    $fib-&gt;($g)-&gt;($n);
}
</code></pre>

<p>そうなると $Y->($fib)->(5) は、以下のように変換できる。</p>

<pre><code>#!perl
$fib-&gt;($g)-&gt;(5)
</code></pre>

<p>$fib->($g) は、my $fib = sub { &#8230; } の $f に $g が代入されるので、$fib->($g)->(5) は、</p>

<pre><code>#!perl
sub {
   my $n = shift;
   return $n &lt;= 2 ? 1 : $g-&gt;($n - 1) + $g-&gt;($n - 2);
}-&gt;(5);
</code></pre>

<p>ということになる。</p>

<p>なのでこの $n に 5 が代入され、結果として $fib->($g)->(5) は以下のように変換される。</p>

<pre><code>#!perl
  $g-&gt;(4) ... [A]
+ $g-&gt;(3) ... [B]
</code></pre>

<p>[A] を更に変換してみると、$g->(4) は $fib->($g)->(4) となり、</p>

<pre><code>#!perl
sub {
   my $n = shift;
   return $n &lt;= 2 ? 1 : $g-&gt;($n - 1) + $g-&gt;($n - 2);
}-&gt;(4);
</code></pre>

<p>を実行するのと同じ。というわけで、$g->(4) は、</p>

<pre><code>#!perl
$g-&gt;(3) + $g-&gt;(2) ... [A]
</code></pre>

<p>になる。同様に [B] を変換すると、</p>

<pre><code>#!perl
$g-&gt;(2) + $g-&gt;(1) ... [B]
</code></pre>

<p>となる。今までのところまでをまとめると、$Y->($fib)->(5) は以下のように変換される。</p>

<pre><code>#!perl
  $g-&gt;(3) + $g-&gt;(2) ... [A]
+ $g-&gt;(2) + $g-&gt;(1) ... [B]
</code></pre>

<p>で、$g->(3) は [B] の変換と同様なので、更に以下のように変換される。</p>

<pre><code>#!perl
  $g-&gt;(2) + $g-&gt;(1) + $g-&gt;(2) ... [A]
+ $g-&gt;(2) + $g-&gt;(1)           ... [B]
</code></pre>

<p>ここで $g->(2) は、</p>

<pre><code>#!perl
sub {
   my $n = shift;
   return $n &lt;= 2 ? 1 : $g-&gt;($n - 1) + $g-&gt;($n - 2);
}-&gt;(2);
</code></pre>

<p>であり、$n &lt;= 2 であれば 1 が返る。ということは、$g->(2) も $g->(1) も 1 だから、[A] + [B] は以下のように変換される。</p>

<pre><code>#!perl
  1 + 1 + 1 ... [A]
+ 1 + 1     ... [B]
</code></pre>

<p>というわけで、結果は 5 になる。ということらしい。なんとなくわかった。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/10/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/12/13/maglica-presentation-at-hatena/">Maglica Presentation At Hatena</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/15/octopress-on-heteml/">How to deploy a blog made by Octopress to Heteml</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/05/maglica-web/">Maglica Web</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/30/vimeo-tag-plugin/">Vimeo tag plugin</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/29/typo-to-octopress/">Typo to Octopress</a>
      </li>
    
  </ul>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Gosuke Miyashita -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mizzyorg';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
