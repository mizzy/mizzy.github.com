
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>mizzy.org</title>
  <meta name="author" content="Gosuke Miyashita">

  
  <meta name="description" content="Linux の iostat が出している数値が、正確には何なのか、ということを知る必要があり、調べてみたのでメモ。 知りたいのは、とりあえずは以下の様に実行した場合の、rrqm/s, wrqm/s, r/s, w/s の 4 つ。 $ iostat -d -x
Device: rrqm/s &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mizzy.org/blog/page/13">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="mizzy.org" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53984-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">mizzy.org</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mizzy.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/05/11/510/">Linux の Iostat は何を見てるのか</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-05-11T01:54:00+09:00" pubdate>May 11<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/05/11/510/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Linux の iostat が出している数値が、正確には何なのか、ということを知る必要があり、調べてみたのでメモ。</p>

<p>知りたいのは、とりあえずは以下の様に実行した場合の、rrqm/s, wrqm/s, r/s, w/s の 4 つ。</p>

<pre><code>$ iostat -d -x
Device:    rrqm/s wrqm/s   r/s   w/s  rsec/s  wsec/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await  svctm  %util
sda          0.02  72.33  3.73 31.23   57.91  830.07    28.96   415.03    25.40     0.77   22.15   3.26  11.39
</code></pre>

<p>特に rrqm/s, wrqm/s が man を読んでもよく分からない。</p>

<pre><code>          rrqm/s
                 The  number  of read requests merged per second that
                 were issued to the device.

          wrqm/s
                 The number of write requests merged per second  that
                 were issued to the device.
</code></pre>

<p>r/s, w/s が実際にデバイスにリクエストされた I/O 数で、rrqm/s, wrqm/s が、プロセスからリクエストされたものの、デバイスに渡される前にマージされたリクエスト数ではないか、推測。それが正しいかどうか確かめる。</p>

<p>また、このリクエスト数というのが正確には何なのか、ということも確かめる。read/write 系のシステムコールの数？</p>

<p>まずはおそらく /proc/diskstat から値を取得しているのだろう、ということで、中身を見てみると、こんな行がある。</p>

<pre><code>8    0 sda 4506815 26232 69968005 66785384 37727406 87380973 1002794888 868225876 125 137597988 935021144
</code></pre>

<p>でもって、sysstat-5.0.5 の iostat.c を見てみると、544行目あたりにこんな記述があった。</p>

<pre><code>if (dev_type == DT_DEVICE)
   i = (fscanf(sysfp, "%lu %lu %llu %lu %lu %lu %llu %lu %lu %lu %lu",
       &amp;sdev.rd_ios, &amp;sdev.rd_merges,
       &amp;sdev.rd_sectors, &amp;sdev.rd_ticks,
       &amp;sdev.wr_ios, &amp;sdev.wr_merges,
       &amp;sdev.wr_sectors, &amp;sdev.wr_ticks,
       &amp;sdev.ios_pgr, &amp;sdev.tot_ticks, &amp;sdev.rq_ticks) == 11);
</code></pre>

<p>/proc/diskstat 内の sda 右横にあるカラム数とも一致してるので、ここと考えて良さそう。そうなると、r/s, rrqm/s が 1, 2番目のカラム、w/s と wrqm/s が 5,6 番目のカラム、ってことになる。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/05/06/508/">Re: DBICとDBIx::Class::Schema::Loader 僕のいろいろな勘違い</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-05-06T19:11:00+09:00" pubdate>May 6<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/05/06/508/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://en.yummy.stripper.jp/?eid=550053">ブログが続かないわけ | DBICとDBIx::Class::Schema::Loader 僕のいろいろな勘違い</a> にて、</p>

<blockquote><p>とはいえ、僕の稼働中のアプリはすでに手動型のSchema で動いている。スキーマを作り直したら、リレーションの設定を全てしなおさなければならないので、それは現実的じゃない。inflate, deflate の指定は、やっぱりすべてのSchema にかかなきゃだめそうだ。</p></blockquote>

<p>とあったので、これに関して少し楽ができる方法をコメントしようと思ったけれど、コメント欄ではうまく伝えられる自信がないので、こちらで書いてみることにしました。</p>

<h3>load_components で 読み込む方法</h3>

<p>DBIx::Class::Schema::Loader ではなく DBIx::Class::Schema を継承したスキーマの場合には、各スキーマファイルに以下の様に書いてあげれば OK です。（既にご存知かもしれませんが。）</p>

<pre><code>package My::Schema::Table;

__PACKAGE__-&gt;load_components(
  "InflateColumn::DateTime",
  "PK::Auto",
  "Core",
);
</code></pre>

<p>すべてのスキーマファイルに書かなきゃいけないことには変わりありませんが、各カラムに inflate/deflate を設定するよりははるかに楽だと思います。</p>

<h3>make_schema_at を使う方法</h3>

<p>make_schema_at でスキーマファイルを生成しているのであれば、こんな感じでリレーションだけ定義した ./tmp/lib/My/Schema/Table.pm をまず用意します。</p>

<pre><code>package My::Schema::Table;

__PACKAGE__-&gt;belongs_to(
    realation =&gt; 'My::Schema::OtherTable
    { 'foreign.id' =&gt; 'self.other_table_id' },
);

1;
</code></pre>

<p>でもって、こんなスクリプトを実行します。</p>

<pre><code>#!/usr/bin/perl

use strict;
use warnings;

use lib qw( ./tmp/lib );
use Carp;
use DBIx::Class::Schema::Loader qw( make_schema_at dump_to_dir:lib dump_overwrite );

make_schema_at(
    'My::Schema::Table',
    {
        components     =&gt; [qw/ ResultSetManager UTF8Columns InflateColumn::DateTime /],
        dump_overwrite =&gt; 1,
    },
    ['dbi:mysql:dbname' ,'user', 'password'],
);
</code></pre>

<p>そうすると、lib/My/Schema/Table.pm に以下の内容を吐き出してくれます。</p>

<pre><code>package My::Schema::Table;

# Created by DBIx::Class::Schema::Loader v0.03009 @ 2007-04-26 18:21:23

use strict;
use warnings;

use base 'DBIx::Class';

__PACKAGE__-&gt;load_components(
  "ResultSetManager",
  "UTF8Columns",
  "InflateColumn::DateTime",
  "PK::Auto",
  "Core",
);
__PACKAGE__-&gt;table("table");
__PACKAGE__-&gt;add_columns(
  "id",
  { data_type =&gt; "INT", default_value =&gt; undef, is_nullable =&gt; 0, size =&gt; 11 },
  "other_table_id",
  { data_type =&gt; "INT", default_value =&gt; 0, is_nullable =&gt; 0, size =&gt; 11 },
  "date",
  { data_type =&gt; "DATE", default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 10 },

__PACKAGE__-&gt;set_primary_key("id");
# These lines loaded from user-supplied external file:
package My::Schema::Table;

__PACKAGE__-&gt;belongs_to(
    employees =&gt; 'My::Schema::Table',
    { 'foreign.id' =&gt; 'self.other_table_id' },
);

1;
# End of lines loaded from user-supplied external file
</code></pre>

<p>この方法を使うと、スキーマを作り直しても、リレーションの再設定をしなくて済みます。</p>

<p>手動でやるのが楽なのか、上の方法のいずれかを使うのが楽なのかは、状況にもよると思いますが、こんな方法もありますよ、ということで、ご参考になれば幸いです。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/05/06/507/">Blosxom から Typo へ</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-05-06T06:10:00+09:00" pubdate>May 6<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/05/06/507/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>色々あって、<a href="http://typosphere.org/">typo</a> へ移行してみた。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/05/01/332/">SVN::TracWiki #2</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-05-01T00:30:00+09:00" pubdate>May 1<span>st</span>, 2007</time>
        
         | <a href="/blog/2007/05/01/332/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
<a class="ext-link" href="http://trac.mizzy.org/public/browser/SVN-TracWiki"><span class="icon"></span>SVN::TracWiki</a> (<a class="ext-link" href="http://svn.mizzy.org/public/SVN-TracWiki/"><span class="icon"></span>svn repos</a>) をアップデート。以下の機能を実現するパッチを、Assurer の開発にも参加してくれている <a class="ext-link" href="http://search.cpan.org/~franckc/"><span class="icon"></span>franck</a> が送ってくれました。
</p>


<ul><li>Plugin::Extract::Pod で Perl プログラムのコミット時に、pod を自動で抽出して Wiki にアップ。</li>
<li>xmlrpc プラグインがなくても Wiki ポストができる。</li></ul>


<p>
Trac はソースコード自体の検索ができないので、当然 pod の内容も検索することができないのですが、このプラグインにより、pod の検索ができるようになります。
</p>


<p>
また、検索だけではなく、<a class="ext-link" href="http://trac.mizzy.org/public/wiki/SVN-TracWiki/lib/SVN/TracWiki.pm"><span class="icon"></span>こんな感じ</a> で pod を Trac の Wiki フォーマットに変換してキレイに表示してくれます。
</p>


<p>
試しに手元にあった XML::Atom をつっこんでみると、<a class="ext-link" href="http://trac.mizzy.org/public/wiki/XML-Atom-0.22/lib/XML/Atom/Server.pm"><span class="icon"></span>こんな感じ</a> になります。
</p>


<p>
あと、File::Extract 内部で利用している File::MMagic::XS が謎の Segmentation Fault で落ちるので、File::MMagic を使うように強引に書き換えたり。
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/05/01/SVN-TracWiki-lib-SVN-TracWiki.pm/">SVN-TracWiki/lib/SVN/TracWiki.pm</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-05-01T00:22:29+09:00" pubdate>May 1<span>st</span>, 2007</time>
        
         | <a href="/blog/2007/05/01/SVN-TracWiki-lib-SVN-TracWiki.pm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>source:SVN-TracWiki/lib/SVN/TracWiki.pm</p>

<h1>NAME</h1>

<p>SVN::TracWiki - [One line description of module&#8217;s purpose here]</p>

<h1>VERSION</h1>

<p>This document describes SVN::TracWiki version 0.0.1</p>

<h1>SYNOPSIS</h1>

<pre><code>    use SVN::TracWiki;
</code></pre>

<h1>DESCRIPTION</h1>

<h1>INTERFACE</h1>

<h1>DIAGNOSTICS</h1>

<p> <code>Error message here, perhaps with %s placeholders</code>:: [Description of error here]
 <code>Another error message here</code>:: [Description of error here]
[Et cetera, et cetera]</p>

<h1>CONFIGURATION AND ENVIRONMENT</h1>

<p>SVN::TracWiki requires no configuration files or environment variables.</p>

<h1>DEPENDENCIES</h1>

<p>None.</p>

<h1>INCOMPATIBILITIES</h1>

<p>None reported.</p>

<h1>BUGS AND LIMITATIONS</h1>

<p>No bugs have been reported.</p>

<p>Please report any bugs or feature requests to <code>bug-svn-tracwiki@rt.cpan.org</code>, or through the web interface at http://rt.cpan.org.</p>

<h1>AUTHOR</h1>

<p>Gosuke Miyashita <code>&lt;gosukenator@gmail.com&gt;</code></p>

<h1>LICENCE AND COPYRIGHT</h1>

<p>Copyright (c) 2007, Gosuke Miyashita <code>&lt;gosukenator@gmail.com&gt;</code>. All rights reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See perlartistic.</p>

<h1>DISCLAIMER OF WARRANTY</h1>

<p>BECAUSE THIS SOFTWARE IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY FOR THE SOFTWARE, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE SOFTWARE &#8220;AS IS&#8221; WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE SOFTWARE IS WITH YOU. SHOULD THE SOFTWARE PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR, OR CORRECTION.</p>

<p>IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR REDISTRIBUTE THE SOFTWARE AS PERMITTED BY THE ABOVE LICENCE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE SOFTWARE (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE SOFTWARE TO OPERATE WITH ANY OTHER SOFTWARE), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom.pm/">XML-Atom-0.22/lib/XML/Atom.pm</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-04-30T23:41:46+09:00" pubdate>Apr 30<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom.pm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>source:XML-Atom-0.22/lib/XML/Atom.pm</p>

<h1>NAME</h1>

<p>XML::Atom - Atom feed and API implementation</p>

<h1>SYNOPSIS</h1>

<pre><code>    use XML::Atom;
</code></pre>

<h1>DESCRIPTION</h1>

<p>Atom is a syndication, API, and archiving format for weblogs and other data. <em>XML::Atom</em> implements the feed format as well as a client for the API.</p>

<h1>LICENSE</h1>

<p><em>XML::Atom</em> is free software; you may redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1>AUTHOR &amp; COPYRIGHT</h1>

<p>Except where otherwise noted, <em>XML::Atom</em> is Copyright 2003-2005 Benjamin Trott, cpan@stupidfool.org. All rights reserved.</p>

<h1>CO-MAINTAINER</h1>

<p>Tatsuhiko Miyagawa <a href="&#x6d;&#x61;&#105;&#x6c;&#x74;&#x6f;&#58;&#x6d;&#x69;&#x79;&#x61;&#103;&#97;&#x77;&#x61;&#64;&#98;&#117;&#x6c;&#x6b;&#110;&#101;&#x77;&#x73;&#x2e;&#x6e;&#x65;&#x74;">&#x6d;&#x69;&#x79;&#97;&#103;&#x61;&#x77;&#97;&#64;&#98;&#x75;&#108;&#x6b;&#110;&#101;&#x77;&#115;&#46;&#x6e;&#101;&#116;</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Util.pm/">XML-Atom-0.22/lib/XML/Atom/Util.pm</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-04-30T23:41:46+09:00" pubdate>Apr 30<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Util.pm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>source:XML-Atom-0.22/lib/XML/Atom/Util.pm</p>

<h1>NAME</h1>

<p>XML::Atom::Util - Utility functions</p>

<h1>SYNOPSIS</h1>

<pre><code>    use XML::Atom::Util qw( iso2dt );
    my $dt = iso2dt($entry-&gt;issued);
</code></pre>

<h1>USAGE</h1>

<h2>iso2dt($iso)</h2>

<p>Transforms the ISO-8601 date <em>$iso&#8221; into a &#8221;DateTime&#8221; object and returns the &#8221;DateTime</em> object.</p>

<h2>encode_xml($str)</h2>

<p>Encodes characters with special meaning in XML into entities and returns the encoded string.</p>

<h1>AUTHOR &amp; COPYRIGHT</h1>

<p>Please see the <em>XML::Atom</em> manpage for author, copyright, and license information.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Server.pm/">XML-Atom-0.22/lib/XML/Atom/Server.pm</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-04-30T23:41:45+09:00" pubdate>Apr 30<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Server.pm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>source:XML-Atom-0.22/lib/XML/Atom/Server.pm</p>

<h1>NAME</h1>

<p>XML::Atom::Server - A server for the Atom API</p>

<h1>SYNOPSIS</h1>

<pre><code>    package My::Server;
    use base qw( XML::Atom::Server );
    sub handle_request {
        my $server = shift;
        $server-&gt;authenticate or return;
        my $method = $server-&gt;request_method;
        if ($method eq 'POST') {
            return $server-&gt;new_post;
        }
        ...
    }

    my %Passwords;
    sub password_for_user {
        my $server = shift;
        my($username) = @_;
        $Passwords{$username};
    }

    sub new_post {
        my $server = shift;
        my $entry = $server-&gt;atom_body or return;
        ## $entry is an XML::Atom::Entry object.
        ## ... Save the new entry ...
    }

    package main;
    my $server = My::Server-&gt;new;
    $server-&gt;run;
</code></pre>

<h1>DESCRIPTION</h1>

<p><em>XML::Atom::Server</em> provides a base class for Atom API servers. It handles all core server processing, both the SOAP and REST formats of the protocol, and WSSE authentication. It can also run as either a mod_perl handler or as part of a CGI program.</p>

<p>It does not provide functions specific to any particular implementation, such as posting an entry, retrieving a list of entries, deleting an entry, etc. Implementations should subclass <em>XML::Atom::Server&#8221;, overriding the &#8221;handle_request</em> method, and handle all functions such as this themselves.</p>

<h1>SUBCLASSING</h1>

<h2>Request Handling</h2>

<p>Subclasses of <em>XML::Atom::Server&#8221; must override the &#8221;handle_request</em> method to perform all request processing. The implementation must set all response headers, including the response code and any relevant HTTP headers, and should return a scalar representing the response body to be sent back to the client.</p>

<p>For example:</p>

<pre><code>    sub handle_request {
        my $server = shift;
        my $method = $server-&gt;request_method;
        if ($method eq 'POST') {
            return $server-&gt;new_post;
        }
        ## ... handle GET, PUT, etc
    }

    sub new_post {
        my $server = shift;
        my $entry = $server-&gt;atom_body or return;
        my $id = save_this_entry($entry);  ## Implementation-specific
        $server-&gt;response_header(Location =&gt; $server-&gt;uri . '/entry_id=' . $id);
        $server-&gt;response_code(201);
        $server-&gt;response_content_type('application/x.atom+xml');
        return serialize_entry($entry);    ## Implementation-specific
    }
</code></pre>

<h2>Authentication</h2>

<p>Servers that require authentication for posting or retrieving entries or feeds should override the <em>password_for_user&#8221; method. Given a username (from the WSSE header), &#8221;password_for_user</em> should return that user&#8217;s password in plaintext. This will then be combined with the nonce and the creation time to generate the digest, which will be compared with the digest sent in the WSSE header. If the supplied username doesn&#8217;t exist in your user database or alike, just return <code>undef</code>.</p>

<p>For example:</p>

<pre><code>    my %Passwords &gt; 'bar' );   ## The password for "foo" is "bar".
    sub password_for_user {
        my $server = shift;
        my($username) = @_;
        $Passwords{$username};
    }
</code></pre>

<h1>METHODS</h1>

<p><em>XML::Atom::Server</em> provides a variety of methods to be used by subclasses for retrieving headers, content, and other request information, and for setting the same on the response.</p>

<h2>Client Request Parameters</h2>

<ul>
<li>$server->uri</li>
</ul>


<p> Returns the URI of the Atom server implementation.</p>

<ul>
<li>$server->request_method</li>
</ul>


<p> Returns the name of the request method sent to the server from the client (for example, <code>GET</code>, <code>POST</code>, etc). Note that if the client sent the request in a SOAP envelope, the method is obtained from the <em>SOAPAction</em> HTTP header.</p>

<ul>
<li>$server->request_header($header)</li>
</ul>


<p> Retrieves the value of the HTTP request header <em>$header</em>.</p>

<ul>
<li>$server->request_content</li>
</ul>


<p> Returns a scalar containing the contents of a POST or PUT request from the client.</p>

<ul>
<li>$server->request_param($param)</li>
</ul>


<p> <em>XML::Atom::Server</em> automatically parses the PATH_INFO sent in the request and breaks it up into key-value pairs. This can be used to pass parameters. For example, in the URI</p>

<pre><code>    http://localhost/atom-server/entry_id=1
</code></pre>

<p> the <em>entry_id</em> parameter would be set to <code>1</code>.</p>

<p> <em>request_param&#8221; returns the value of the value of the parameter &#8221;$param</em>.</p>

<h2>Setting up the Response</h2>

<ul>
<li>$server->response_header($header, $value)</li>
</ul>


<p> Sets the value of the HTTP response header <em>$header&#8221; to &#8221;$value</em>.</p>

<ul>
<li>$server->response_code([ $code ])</li>
</ul>


<p> Returns the current response code to be sent back to the client, and if <em>$code</em> is given, sets the response code.</p>

<ul>
<li>$server->response_content_type([ $type ])</li>
</ul>


<p> Returns the current <em>Content-Type&#8221; header to be sent back to the client, and &#8221;$type</em> is given, sets the value for that header.</p>

<h2>Processing the Request</h2>

<ul>
<li>$server->authenticate</li>
</ul>


<p> Attempts to authenticate the request based on the authentication information present in the request (currently just WSSE). This will call the <em>password_for_user</em> method in the subclass to obtain the cleartext password for the username given in the request.</p>

<ul>
<li>$server->atom_body</li>
</ul>


<p> Returns an <em>XML::Atom::Entry</em> object containing the entry sent in the request.</p>

<h1>USAGE</h1>

<p>Once you have defined your server subclass, you can set it up either as a CGI program or as a mod_perl handler.</p>

<p>A simple CGI program would look something like this:</p>

<pre><code>    #!/usr/bin/perl -w
    use strict;

    use My::Server;
    my $server = My::Server-&gt;new;
    $server-&gt;run;
</code></pre>

<p>A simple mod_perl handler configuration would look something like this:</p>

<pre><code>    PerlModule My::Server
    &lt;Location /atom-server&gt;
        SetHandler perl-script
        PerlHandler My::Server
    &lt;/Location&gt;
</code></pre>

<h1>ERROR HANDLING</h1>

<p>If you wish to return an error from <em>handle_request&#8221;, you can use the built-in &#8221;error</em> method:</p>

<pre><code>    sub handle_request {
        my $server = shift;
        ...
        return $server-&gt;error(500, "Something went wrong");
    }
</code></pre>

<p>This will be returned to the client with a response code of 500 and an error string of <code>Something went wrong</code>. Errors are automatically serialized into SOAP faults if the incoming request is enclosed in a SOAP envelope.</p>

<h1>AUTHOR &amp; COPYRIGHT</h1>

<p>Please see the <em>XML::Atom</em> manpage for author, copyright, and license information.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Person.pm/">XML-Atom-0.22/lib/XML/Atom/Person.pm</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-04-30T23:41:45+09:00" pubdate>Apr 30<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Person.pm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>source:XML-Atom-0.22/lib/XML/Atom/Person.pm</p>

<h1>NAME</h1>

<p>XML::Atom::Person - Author or contributor object</p>

<h1>SYNOPSIS</h1>

<pre><code>    my $person = XML::Atom::Person-&gt;new;
    $person-&gt;email('foo@example.com');
    $person-&gt;name('Foo Bar');
    $entry-&gt;author($person);
</code></pre>

<h1>DESCRIPTION</h1>

<p><em>XML::Atom::Person</em> represents an author or contributor element in an Atom feed or entry.</p>

<h1>USAGE</h1>

<h2>XML::Atom::Person->new</h2>

<h2>$person->email([ $email ])</h2>

<h2>$person->name([ $name ])</h2>

<h2>$person->uri([ $uri ])</h2>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Feed.pm/">XML-Atom-0.22/lib/XML/Atom/Feed.pm</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2007-04-30T23:41:45+09:00" pubdate>Apr 30<span>th</span>, 2007</time>
        
         | <a href="/blog/2007/04/30/XML-Atom-0.22-lib-XML-Atom-Feed.pm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>source:XML-Atom-0.22/lib/XML/Atom/Feed.pm</p>

<h1>NAME</h1>

<p>XML::Atom::Feed - Atom feed</p>

<h1>SYNOPSIS</h1>

<pre><code>    use XML::Atom::Feed;
    use XML::Atom::Entry;
    my $feed = XML::Atom::Feed-&gt;new;
    $feed-&gt;title('My Weblog');
    my $entry = XML::Atom::Entry-&gt;new;
    $entry-&gt;title('First Post');
    $entry-&gt;content('Post Body');
    $feed-&gt;add_entry($entry);
    $feed-&gt;add_entry($entry, { mode =&gt; 'insert' });

    my @entries = $feed-&gt;entries;
    my $xml = $feed-&gt;as_xml;

    ## Get a list of the &lt;link rel="..." /&gt; tags in the feed.
    my $links = $feed-&gt;link;

    ## Find all of the Atom feeds on a given page, using auto-discovery.
    my @uris = XML::Atom::Feed-&gt;find_feeds('http://www.example.com/');

    ## Use auto-discovery to load the first Atom feed on a given page.
    my $feed = XML::Atom::Feed-&gt;new(URI-&gt;new('http://www.example.com/'));
</code></pre>

<h1>USAGE</h1>

<h2>XML::Atom::Feed->new([ $stream ])</h2>

<p>Creates a new feed object, and if <em>$stream&#8221; is supplied, fills it with the data specified by &#8221;$stream</em>.</p>

<p>Automatically handles autodiscovery if <em>$stream</em> is a URI (see below).</p>

<p>Returns the new <em>XML::Atom::Feed</em> object. On failure, returns <code>undef</code>.</p>

<p><em>$stream</em> can be any one of the following:</p>

<ul>
<li>Reference to a scalar</li>
</ul>


<p> This is treated as the XML body of the feed.</p>

<ul>
<li>Scalar</li>
</ul>


<p> This is treated as the name of a file containing the feed XML.</p>

<ul>
<li>Filehandle</li>
</ul>


<p> This is treated as an open filehandle from which the feed XML can be read.</p>

<ul>
<li>URI object</li>
</ul>


<p> This is treated as a URI, and the feed XML will be retrieved from the URI.</p>

<p> If the content type returned from fetching the content at URI is <em>text/html&#8221;, this method will automatically try to perform auto-discovery by looking for a &#8221;<link></em> tag describing the feed URL. If such a URL is found, the feed XML will be automatically retrieved.</p>

<p> If the URI is already of a feed, no auto-discovery is necessary, and the feed XML will be retrieved and parsed as normal.</p>

<h2>XML::Atom::Feed->find_feeds($uri)</h2>

<p>Given a URI <em>$uri&#8221;, use auto-discovery to find all of the Atom feeds linked from that page (using &#8221;<link></em> tags).</p>

<p>Returns a list of feed URIs.</p>

<h2>$feed->link</h2>

<p>If called in scalar context, returns an <em>XML::Atom::Link&#8221; object corresponding to the first &#8221;<link></em> tag found in the feed.</p>

<p>If called in list context, returns a list of <em>XML::Atom::Link&#8221; objects corresponding to all of the &#8221;<link></em> tags found in the feed.</p>

<h2>$feed->add_link($link)</h2>

<p>Adds the link <em>$link&#8221;, which must be an &#8221;XML::Atom::Link&#8221; object, to the feed as a new &#8221;<link></em> tag. For example:</p>

<pre><code>    my $link = XML::Atom::Link-&gt;new;
    $link-&gt;type('text/html');
    $link-&gt;rel('alternate');
    $link-&gt;href('http://www.example.com/');
    $feed-&gt;add_link($link);
</code></pre>

<h2>$feed->add_entry($entry)</h2>

<p>Adds the entry <em>$entry&#8221;, which must be an &#8221;XML::Atom::Entry</em> object, to the feed. If you want to add an entry before existent entries, you can pass optional hash reference containing <code>mode</code> value set to <code>insert</code>.</p>

<pre><code>  $feed-&gt;add_entry($entry, { mode =&gt; 'insert' });
</code></pre>

<h2>$feed->entries</h2>

<p>Returns list of XML::Atom::Entry objects contained in the feed.</p>

<h2>$feed->language</h2>

<p>Returns the language of the feed, from <em>xml:lang</em>.</p>

<h2>$feed->author([ $author ])</h2>

<p>Returns an <em>XML::Atom::Person</em> object representing the author of the entry, or <code>undef</code> if there is no author information present.</p>

<p>If <em>$author&#8221; is supplied, it should be an &#8221;XML::Atom::Person</em> object representing the author. For example:</p>

<pre><code>    my $author = XML::Atom::Person-&gt;new;
    $author-&gt;name('Foo Bar');
    $author-&gt;email('foo@bar.com');
    $feed-&gt;author($author);
</code></pre>

<h1>UNICODE FLAGS</h1>

<p>By default, XML::Atom takes off all the Unicode flag fro mthe feed content. For example,</p>

<pre><code>  my $title = $feed-&gt;title;
</code></pre>

<p>the variable <code>$title</code> contains UTF-8 bytes without Unicode flag set, even if the feed title contains some multibyte chracters.</p>

<p>If you don&#8217;t like this behaviour and wants to andle everything as Unicode characters (rather than UTF-8 bytes), set <code>$XML::Atom::ForceUnicode</code> flag to 1.</p>

<pre><code>  $XML::Atom::ForceUnicode = 1;
</code></pre>

<p>then all the data returned from XML::Atom::Feed object and XML::Atom::Entry object etc., will have Unicode flag set.</p>

<p>The only exception will be <code>$entry-&gt;content-&gt;body</code>, if content type is not text/* (e.g. image/gif). In that case, the content body is still binary data, without Unicode flag set.</p>

<h1>CREATING ATOM 1.0 FEEDS</h1>

<p>By default, XML::Atom::Feed and other classes (Entry, Link and Content) will create entities using Atom 0.3 namespaces. In order to create 1.0 feed and entry elements, you can set <em>Version</em> as a parameter, like:</p>

<pre><code>  $feed &gt; 1.0);
  $entry &gt; 1.0);
</code></pre>

<p>Setting those Version to every element would be sometimes painful. In that case, you can override the default version number by setting <code>$XML::Atom::DefaultVersion</code> global variable to &#8220;1.0&#8221;.</p>

<pre><code>  use XML::Atom;

  $XML::Atom::DefaultVersion = "1.0";

  my $feed = XML::Atom::Feed-&gt;new;
  $feed-&gt;title("blah");

  my $entry = XML::Atom::Entry-&gt;new;
  $feed-&gt;add_entry($entry);

  $feed-&gt;version; # 1.0
</code></pre>

<h1>AUTHOR &amp; COPYRIGHT</h1>

<p>Please see the <em>XML::Atom</em> manpage for author, copyright, and license information.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/14/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/12/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/10/30/vimeo-tag-plugin/">vimeo tag plugin</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/29/typo-to-octopress/">Typo to Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/21/twan-tag-plugin/">TWAN tag plugin for Jekyll</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/17/first-post/">自宅サーバが死にました</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/05/MyResume/">MyResume</a>
      </li>
    
  </ul>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Gosuke Miyashita -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mizzyorg';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
