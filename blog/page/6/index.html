
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>mizzy.org</title>
  <meta name="author" content="Gosuke Miyashita">

  
  <meta name="description" content="CentOS 5.4 から KVM が正式にサポートされたようなので、試してみた。 KVM が動く環境をつくる まずは既存の 5.3 環境から 5.4 にアップグレード。 $ sudo yum -y upgrade 不要になった kernel-xen は削除。 $ sudo yum -y &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mizzy.org/blog/page/6">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="mizzy.org" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-53984-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">mizzy.org</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mizzy.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/31/KvmOnCentOS54/">KvmOnCentOS54</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-10-31T11:40:59+09:00" pubdate>Oct 31<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/10/31/KvmOnCentOS54/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>CentOS 5.4 から KVM が正式にサポートされたようなので、試してみた。</p>

<h1>KVM が動く環境をつくる</h1>

<p>まずは既存の 5.3 環境から 5.4 にアップグレード。</p>

<pre><code>$ sudo yum -y upgrade
</code></pre>

<p>不要になった kernel-xen は削除。</p>

<pre><code>$ sudo yum -y remove kernel-xen
</code></pre>

<p>kmod-kvm, kvm をインストール。</p>

<pre><code>$ sudo yum -y install kmod-kvm kvm
</code></pre>

<p>/boot/grub/menu.lst 修正。</p>

<pre><code>title CentOS (2.6.18-164.el5)
    root (hd0,0)
    kernel /vmlinuz-2.6.18-164.el5 ro root=/dev/vg00/lv_root vga=773
    initrd /initrd-2.6.18-164.el5.img
</code></pre>

<p>再起動する。</p>

<h1>Cobbler + Koan での VM 作成</h1>

<p>今まで Xen をつかっていて、Cobbler + Koan で VM をつくっていたが、KVM でも同じ手順でできるはず、ってことで koan コマンド実行してみた。</p>

<pre><code>$ sudo koan --server localhost --virt --profile=FC11-x86_64 --virt-name=fc11-kvm
- looking for Cobbler at http://localhost/cobbler_api
- reading URL: http://192.168.10.11/cblr/svc/op/ks/profile/FC11-x86_64
install_tree: http://192.168.10.11:80/cblr/links/FC11-x86_64
libvirtd (pid  3681) is running...
- using qemu hypervisor, type=kvm
Fri, 30 Oct 2009 17:37:07 DEBUG    No conn passed to Guest, opening URI 'qemu:///system'
Fri, 30 Oct 2009 17:37:07 DEBUG    DistroInstaller location is a network source.
libvir: QEMU error : Domain not found: no domain with matching name 'fc11-kvm'
- adding disk: /opt/qemu//fc11-kvm-disk0 of size 5

... 中略 ...

libvir: QEMU error : internal error Failed to add tap interface 'vnet%d' to bridge 'xenbr0' : No such device

... 以下略 ...
</code></pre>

<p>type=kvm と表示されているので、KVM が使われているようだが、エラーに。</p>

<p>Xen ではないため、xenbr0 が存在しないが、Xen の時の設定が Cobbler に残っていた。</p>

<p>libvirt が生成する virbr0 というブリッジインターフェースが存在するが、外部との接続ができないようなので、新たにブリッジインターフェースを作成することにした。</p>

<p>まずは /etc/sysconfig/network-scripts/ifcfg-br0 を作成。</p>

<pre><code>DEVICE=br0
TYPE=Bridge
BOOTPROTO=dhcp
ONBOOT=yes
</code></pre>

<p>/etc/sysconfig/network-scripts/ifcfg-eth0 に以下を追加。</p>

<pre><code>BRIDGE=br0
</code></pre>

<p>ネットワーク再起動する。</p>

<pre><code>$ sudo /etc/init.d/network restart
</code></pre>

<p>これで br0 ができるので、br0 を使うように cobbler コマンドで設定する。</p>

<pre><code>$ sudo cobbler profile edit --name=FC11-x86_64 --virt-bridge=br0
</code></pre>

<p>ついでに、CUI からコンソール接続できるように、この profile で利用している /var/lib/cobbler/kickstarts/sample.ks の bootloader 行を以下のように修正。</p>

<pre><code>bootloader --location=mbr --append="console=tty0 console=ttyS0,115200"
</code></pre>

<p>再度 koan を実行して VM 作成。</p>

<pre><code>$ sudo koan --server localhost --virt --profile=FC11-x86_64 --virt-name=fc11-kvm
</code></pre>

<p>状態確認。</p>

<pre><code>$ sudo virsh list --all                                            
 Id Name                 State
----------------------------------
 10 fc11-kvm             running
</code></pre>

<p>インストールが終わると、shut off になる。</p>

<pre><code>$ sudo virsh list --all
 Id Name                 State
----------------------------------
  - fc11-kvm             shut off
</code></pre>

<p>起動する。</p>

<pre><code>$ sudo virsh start fc11-kvm
</code></pre>

<p>コンソール接続してみる。</p>

<pre><code>$ sudo virsh console fc11-kvm
Connected to domain fc11-kvm
Escape character is ^]
?G      Welcome to Fedora 
        Press 'I' to enter interactive startup.
Starting udev: G[  OK  ]
Setting hostname h029.southpark:  [  OK  ]
mdadm: No arrays found in config file or automatically
Setting up Logical Volume Management:   2 logical volume(s) in volume group "vg_h029" now active

... 中略 ...

Fedora release 11 (Leonidas)
Kernel 2.6.29.4-167.fc11.x86_64 on an x86_64 (/dev/ttyS0)

h029.southpark login: 
</code></pre>

<h1>ディスク追加してみる</h1>

<p>イメージファイル作成。</p>

<pre><code>$ sudo qemu-img create /opt/qemu/fc11-kvm-disk1 8G
</code></pre>

<p>disk.xml を以下の内容で作成。</p>

<pre><code>&lt;disk type='file' device='disk'&gt;
  &lt;source file='/opt/qemu/fc11-kvm-disk1'/&gt;
  &lt;target dev='vdb' bus='virtio' /&gt;
&lt;/disk&gt;
</code></pre>

<p>追加する。</p>

<pre><code>$ sudo virsh attach-device fc11-kvm disk.xml
Device attached successfully
</code></pre>

<p>これで /dev/vdb が VM から見えるようになる。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/18/ScalaObjectCloning/">ScalaObjectCloning</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-10-18T11:51:50+09:00" pubdate>Oct 18<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/10/18/ScalaObjectCloning/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.amazon.co.jp/dp/4797327030/">Java言語で学ぶデザインパターン入門</a> の第6章 Prototype を <a href="http://github.com/mizzy/scala-design-patterns/tree/master/Prototype/">Scala で書き直してみて</a>、オブジェクトのクローニングでちょっとつまづいたのでメモ。</p>

<p>結論を先に言うと、オブジェクトのクローニングしたい場合には、クラスやトレイトの宣言時に、@cloneable アノテーションを入れると OK。</p>

<pre><code>@cloneable class Hoge {
  ...
}
</code></pre>

<p>以下、つまづいて調べた経緯。元書籍での Product クラスは以下のように、Cloneable を継承している。</p>

<pre><code>#!java
package framework;

public interface Product extends Cloneable {
    public abstract void use(String s);
    public abstract Product createClone(); 
}
</code></pre>

<p>で、Scala でのクローニングについて、「Scala cloneable」でググると、一番上に出てきた http://www.scala-lang.org/node/110 では、以下のようなコードが載っていた。</p>

<pre><code>trait Cloneable extends java.lang.Cloneable {
  override def clone(): Cloneable = { super.clone(); this }
}
trait Resetable {
  def reset: Unit
}
</code></pre>

<p>これを参考にして、Product クラスを Scala で以下のように書き直してみた。</p>

<pre><code>package framework

trait Product extends java.lang.Cloneable {
  def use(s: String): Unit
  def createClone(): Product
  override def clone(): Cloneable = { super.clone(); this }
}
</code></pre>

<p>これでとりあえずは動いたんだけど、いまいちスッキリしない。そもそも Scala は Java だけではなく、.NET でも動くということなんだけど、java.lang.Cloneable を継承してると、Java でしか動かなくてイマイチ。（まあ、習作用コードでそこまで気にする必要もないんだけど。）</p>

<p>というわけで調べてみたら、@cloneable アノテーションを使えばいいみたい。</p>

<pre><code>package framework

@cloneable trait Product {
  def use(s: String): Unit
  def createClone(): Product
}
</code></pre>

<p>これで意図通りに動いた。</p>

<p>@cloneable を頭に入れないと、実行時に CloneNotSupportedException が発生する。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/06/PacSec2009/">PacSec2009</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-10-06T23:16:52+09:00" pubdate>Oct 6<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/10/06/PacSec2009/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今年も <a href="http://pacsec.jp/">PacSec</a> の季節がやってきました。昨年は二つほどスライドの翻訳をさせて頂いたのですが、残念ながら当日は体調不良で参加できませんでした…</p>

<p>今年も昨年同様、スライド翻訳をお手伝いさせて頂くのですが、一緒にお手伝いしてくださる方を募集しています。興味のある方は、gosukenator at gmail.com までご連絡ください。（無料でカンファレンスに参加できる上に、豪華なお弁当つきです。懇親会も無料で参加できる、はず。）</p>

<p>翻訳に対する考え方なんかは、<a href="http://trombik.mine.nu/~cherry/w/index.php/2008/11/16/1471/pacsec-and-translation">I, newbie の trombik さんのブログをご参照ください</a> 。</p>

<p>また、今年の PacSec の概要や、過去どんな感じだったのかなど、興味がある方は以下のリンクをご参照ください。</p>

<ul>
<li>http://pacsec.jp/speakers.html</li>
<li>http://twitter.com/Pacsecjp</li>
<li>http://gihyo.jp/admin/serial/01/sysadmin-toolbox/0004</li>
<li>http://trac.mizzy.org/public/wiki/PacSec2007</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/06/ScalaDesignPatterns/">ScalaDesignPatterns</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-10-06T00:10:45+09:00" pubdate>Oct 6<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/10/06/ScalaDesignPatterns/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.amazon.co.jp/dp/4844327453">Scalaスケーラブルプログラミング</a> をコードを書き写しながらざーっと読んだんだけど、全然身になってない気がするので、結城先生の <a href="http://www.amazon.co.jp/dp/4797327030/">Java言語で学ぶデザインパターン入門</a> のサンプルコードを <a href="http://github.com/mizzy/scala-design-patterns">Scala で実装して github にアップ</a> してみることにした。</p>

<p>とりあえず飽きるまでやります。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/15/CanBadge/">CanBadge</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-09-15T00:05:20+09:00" pubdate>Sep 15<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/09/15/CanBadge/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>5歳になる娘の幼稚園帽子。</p>

<p>[[Image(http://trac.mizzy.org/public/attachment/wiki/CanBadge/canbadge.jpg?format=raw)]]</p>

<p>ちなみに小3の長男はPerl Best Practicesの布製バッグを体育用具入れとして使ってる。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/11/YapcAsia2009TokyoPresentation/">YapcAsia2009TokyoPresentation</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-09-11T00:21:28+09:00" pubdate>Sep 11<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/09/11/YapcAsia2009TokyoPresentation/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ひとつ目は <a href="http://conferences.yapcasia.org/ya2009/talk/2166">ペパボでの Perl のつかいかた</a> 。<a href="http://d.hatena.ne.jp/hiboma/">id:hiboma</a> と一緒にプレゼンしました。<a href="http://d.hatena.ne.jp/naoya/">お兄さん</a>、ネタに使わせてもらってすみません＆ありがとうございました。後半のロリポの話は、二人で休日も返上してがっつり取り組んだプロジェクトだったので、ぜひ二人で発表したい、と思い、一緒にやらせてもらいました。資料の最新版は id:hiboma が持ってるので、そのうちアップしてくれると思います。</p>

<p>ふたつ目は <a href="http://conferences.yapcasia.org/ya2009/talk/2220">Danga::Socketの非同期処理の仕組みとPerlbalで非同期処理するプラグインを書く方法</a> 。<a href="http://www.slideshare.net/mizzy/how-dangasocket-handles-asynchronous-processing-and-how-to-write-asynchronous-perlbal-plugins">英語版資料</a> と <a href="http://www.slideshare.net/mizzy/dangasocketperlbal">日本語版資料</a> を slideshare にアップしています。</p>

<p>また、プラグインのコードは、プレゼン中は概要しか紹介できなかったので、実際に動くサンプルを <a href="http://github.com/mizzy/perlbal-async-plugin-example/tree/master">github にアップ</a>しています。Perlbal::ClientProxy のパッチと設定ファイルも合わせて置いてあります。</p>

<p>ただ、プレゼンした手法は、以下の点でとても実用的とは言えません。</p>

<ul>
<li>本体に手を入れなければいけない</li>
<li>特定の hook にしか対応してない</li>
<li>同じフックで複数の非同期処理プラグインを動かすことができない</li>
</ul>


<p>本体に手を入れるのはしかたないとして、特定のフックに依存せずに、同じフックで複数の非同期処理プラグインを動かせるようするにはどうすればいいのか、今のところノーアイデアです。これがすっきりできるように実装できれば、ぜひパッチを送りたいところなのですが、今のところ必要に駆られてないので、たぶんやらないと思います。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/02/DeveloperRecruitAtPaperboy/">DeveloperRecruitAtPaperboy</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-09-02T02:16:46+09:00" pubdate>Sep 2<span>nd</span>, 2009</time>
        
         | <a href="/blog/2009/09/02/DeveloperRecruitAtPaperboy/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ペパボでは以下の2つのサービスで開発者を募集中です。</p>

<ul>
<li><a href="http://www.paperboy.co.jp/recruit/job/090821.php">Color Me Shop!pro</a></li>
<li><a href="http://www.paperboy.co.jp/recruit/job/090806.php">30days Album</a></li>
</ul>


<p>併せて<a href="http://www.paperboy.co.jp/recruit/job/090821b.php">開発アルバイト</a>も募集中です。</p>

<p>詳しくは募集要項をご確認ください。</p>

<p>募集要項にはありませんが、採用された方にはドクターペッパーチェリーを差し上げます。合い言葉は「ドクターペッパーチェリー飲みたい！」です。僕との面接時に必ず声に出して言ってください。</p>

<p>[[Image(http://gyazo.com/37db61b8bd76e406987622d9863fbe5f.png)]]</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/13/YapcAsia2009/">YapcAsia2009</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-08-13T01:18:44+09:00" pubdate>Aug 13<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/08/13/YapcAsia2009/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>このところ、ほとんどエントリ更新してませんが、それは、<a href="http://japan.cnet.com/extra/paperboy_0907/story/0,3800098768,20394957,00.htm">ナウでヤングなレンタルサーバー ロリポップ！のインフラ再構築</a> で多忙だったからです。（それだけではないですが。）</p>

<p>というわけで、ブログエントリをほとんど書いてないので細切れにもなりようがないのですが、ロリポ含めて、ペパボが提供するサービスの中で、Perl がどのように使われているのかという話を <a href="http://d.hatena.ne.jp/hiboma/">id:hiboma</a> と一緒に YAPC::Asia 2009 でさせていただくことにしました。</p>

<p>また、それとは別に、以前からの関心事であった、Perlbal で非同期処理するプラグインを書く方法についても、ベースとなる Danga::Socket の説明も含めて、お話したいと思います。</p>

<p>YAPC::Asia 2009 は9月10日(木)と11日(金)の2日間、東京工業大学大岡山キャンパスで開催されます。すでにチケット販売も始まったので、興味のある方はお越しいただければ、と思います。</p>

<ul>
<li><a href="http://conferences.yapcasia.org/ya2009/">YAPC::Asia 2009</a></li>
<li><a href="http://conferences.yapcasia.org/ya2009/talk/2166">ペパボでの Perl のつかいかた</a></li>
<li><a href="http://conferences.yapcasia.org/ya2009/talk/2220">Perlbalで非同期処理するプラグインを書く方法</a></li>
</ul>


<p>【参考文献】</p>

<ul>
<li>http://d.hatena.ne.jp/hirose31/20090807/1249611130</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/08/06/InotifyAndMakuosan/">InotifyAndMakuosan</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-08-06T08:05:40+09:00" pubdate>Aug 6<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/08/06/InotifyAndMakuosan/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ファイルのミラーリングツールとしては rsync が最も使われていると思いますが、差分チェックの負荷が大きく、できればつかうのやめたいなー、と思っていたところ、<a href="http://gihyo.jp/magazine/SD/archive/2009/200908">Software Design 2009年8月号</a> に <a href="http://code.google.com/p/lsyncd/">lsyncd</a> というツールが載っていて、お、これはと思って見てみたのですが、仕組みとしては inotify + rsync なので、結局は rsync を裏で呼び出していて、差分チェックの呪縛からは逃れられません。</p>

<p>inotify でファイルの更新イベント受け取ってるんだから、さらに rsync で差分チェックする必要はないじゃん、と思うわけですが、なんらかの理由でイベントが受け取れない可能性もあるため、二重チェックした方が安全なんでしょうね。</p>

<p>でもやっぱり余分な負荷はかけたくない、ってことで思いついたのが、inotify で更新イベントを検知したファイルを、<a href="http://lab.klab.org/wiki/Makuosan">makuosan</a> の msync コマンドに渡してミラーリングする方法。（makusan の詳しい解説は、<a href="http://gihyo.jp/magazine/wdpress/archive/2009/vol51">WEB+DB PRESS Vol.51</a> に載ってます。）</p>

<p>そこで以下のようなコードを書いて動かしてみたところ、いい感じでファイルが同期できることを確認しました。</p>

<pre><code>#!perl
#!/usr/bin/perl

use strict;
use warnings;
use File::ChangeNotify;

my $base = '/home/miya/work';
my $watcher = File::ChangeNotify-&gt;instantiate_watcher(
    directories =&gt; [ $base ],
);

while ( my @events = $watcher-&gt;wait_for_events() ) {
    for my $event ( @events ) {
        my $path = $event-&gt;path;
        $path =~ s!$base/!!;
        `msync --sync $path`;
    }
}

exit;
</code></pre>

<p>とは言っても、実運用で使うためには、イベントをとりこぼさない、またはとりこぼしてもリカバーするような仕組みを考えたり、負荷テストをしてみたりとか、色々と考慮しなければいけないことはありますが、それはまあおいおいってことで。</p>

<p>また、<a href="http://search.cpan.org/~drolsky/File-ChangeNotify/">File::ChangeNotify</a> がすべての inotify イベントに対応してるわけではなく、IN_CREATE, IN_MODIFY, IN_DELETE にしか対応してないため、パーミッション変更とかファイルの移動なんかは検知できない、という問題もあります。（パッチ書けばいけそうなので、書いてみるつもりです。）</p>

<p>File::ChangeNotify 自体は inotify だけじゃなく、他の仕組みにも対応できるようになっていて、inotify が使える Linux kernel 2.6.13 以降であれば File::ChangeNotify::Watcher::Inotify が、それ以外であれば File::ChangeNotify::Watcher::Default が自動的に呼ばれるようになってます。なので、Mac OS X の FSEvents に対応した File::ChangeNotify::Watcher::FSEvents とか書けば、Mac では自動的に FSEvents で更新イベントを検知、ってこともできそうです。</p>

<p>ともかく、rsync の負荷には困っているので、今後この辺の方法論は詰めていきたいな、と思っています。</p>

<p><em>追記</em></p>

<p><a href="http://github.com/miyagawa/File-ChangeNotify-Watcher-MacFSEvents/tree">miyagawa さんによる File::ChangeNotify::Watcher::MacFSEvents が github にありました</a>。ただし、FSEventsではファイル名とかイベントの種類はとれないそうです。Wikipedia 見てもそんな感じのことが書いてますね。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/07/21/library-perl-trunk-Net-Amazon-ECS-lib-Net-Amazon-ECS.pm/">library/perl/trunk/Net-Amazon-ECS/lib/Net/Amazon/ECS.pm</a></h1>
    
    
      <p class="meta">
        




  

<time datetime="2009-07-21T00:58:15+09:00" pubdate>Jul 21<span>st</span>, 2009</time>
        
         | <a href="/blog/2009/07/21/library-perl-trunk-Net-Amazon-ECS-lib-Net-Amazon-ECS.pm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>source:library/perl/trunk/Net-Amazon-ECS/lib/Net/Amazon/ECS.pm</p>

<h1>NAME</h1>

<p>Net::Amazon::ECS - [One line description of module&#8217;s purpose here]</p>

<h1>VERSION</h1>

<p>This document describes Net::Amazon::ECS version 0.0.1</p>

<h1>SYNOPSIS</h1>

<pre><code>    use Net::Amazon::ECS;

    my $ua =  Net::Amazon::ECS-&gt;new(
        access_key_id =&gt; 'YOUR_AWS_ACCESS_KEY_ID',
        associate_tag =&gt; 'YOUR_AFFILIATE_ID',
        locale        =&gt; 'jp',
    );

    my $req = Net::Amazon::Request::Keyword-&gt;new(
        keywords     =&gt; 'SEARCH KEYWORDS',
        search_index =&gt; 'books',
        sort         =&gt; 'daterank',
    );

    my $res = $ua-&gt;request($req);

    croak $res-&gt;message if $res-&gt;is_error;

    my @items = $res-&gt;items;
</code></pre>

<h1>DESCRIPTION</h1>

<h1>INTERFACE</h1>

<h1>DIAGNOSTICS</h1>

<p> <code>Error message here, perhaps with %s placeholders</code>:: [Description of error here]
 <code>Another error message here</code>:: [Description of error here]
[Et cetera, et cetera]</p>

<h1>CONFIGURATION AND ENVIRONMENT</h1>

<p>Net::Amazon::ECS requires no configuration files or environment variables.</p>

<h1>DEPENDENCIES</h1>

<p>None.</p>

<h1>INCOMPATIBILITIES</h1>

<p>None reported.</p>

<h1>BUGS AND LIMITATIONS</h1>

<p>No bugs have been reported.</p>

<p>Please report any bugs or feature requests to <code>bug-net-amazon-ecs@rt.cpan.org</code>, or through the web interface at http://rt.cpan.org.</p>

<h1>AUTHOR</h1>

<p>Gosuke Miyashita <code>&lt;gosukenator@gmail.com&gt;</code></p>

<h1>LICENCE AND COPYRIGHT</h1>

<p>Copyright (c) 2006, Gosuke Miyashita <code>&lt;gosukenator@gmail.com&gt;</code>. All rights reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See perlartistic.</p>

<h1>DISCLAIMER OF WARRANTY</h1>

<p>BECAUSE THIS SOFTWARE IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY FOR THE SOFTWARE, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE SOFTWARE &#8220;AS IS&#8221; WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE SOFTWARE IS WITH YOU. SHOULD THE SOFTWARE PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR, OR CORRECTION.</p>

<p>IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR REDISTRIBUTE THE SOFTWARE AS PERMITTED BY THE ABOVE LICENCE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE SOFTWARE (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE SOFTWARE TO OPERATE WITH ANY OTHER SOFTWARE), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/7/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/11/15/octopress-on-heteml/">How to deploy a blog made by Octopress to Heteml</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/05/maglica-web/">Maglica Web</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/30/vimeo-tag-plugin/">Vimeo tag plugin</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/29/typo-to-octopress/">Typo to Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/10/21/twan-tag-plugin/">TWAN tag plugin for Jekyll</a>
      </li>
    
  </ul>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Gosuke Miyashita -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'mizzyorg';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
